<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pedidos Bio-Fix - Mobile</title>
  <style>
    :root{
      --bg-white:#ffffff;
      --bg-gray:#e6e6e6;
      --bf-blue:#1168a7;
      --text:#222;

      --sys-monopieza:#00bcd4; /* cian */
      --sys-hi:#d4101b; /* hi rojo */
      --sys-he:#429d56; /* he verde */
      --sys-conomorse:#926db2;
      --sys-basal:#666666;
      --sys-compresivo:#d10084;
      --sys-multiunit:#fab211;
      --sys-digitales:#4f039b;
      --sys-analogicos:#333333; /* gris oscuro */
      --sys-herramental:#333333;

      --safe-margin:14px;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    html,body{height:100%;margin:0;background:var(--bg-white);color:var(--text)}
    .app{max-width:420px;margin:0 auto;border-left:1px solid #ddd;border-right:1px solid #ddd;min-height:100vh;background:linear-gradient(180, #fff 0%, #fbfbfb 100%);}
    header{background:var(--bf-blue);color:#fff;padding:18px var(--safe-margin);display:flex;gap:12px;align-items:center}
    header img{width:44px;height:44px;border-radius:8px;object-fit:cover}
    header h1{font-size:18px;margin:0}
    .container{padding:16px}
    .card{background:var(--bg-white);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 6px 20px rgba(17,104,167,0.06)}
    .big-btn{display:block;width:100%;padding:14px;border-radius:10px;border:0;font-weight:600;font-size:16px}
    .btn-primary{background:var(--bf-blue);color:#fff}
    .btn-outline{background:transparent;border:1px solid #ddd;color:var(--text)}
    .row{display:flex;gap:8px}
    .col{flex:1}
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=text], input[type=number], select{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd}
    .hidden{display:none}
    .spaced{margin-top:12px}
    .small{font-size:13px;color:#666}
    .system-list{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .system-item{padding:10px;border-radius:10px;text-align:center;font-weight:600;color:#fff}
    .list-group{display:flex;flex-direction:column;gap:8px}
    .product-row{display:flex;gap:8px;align-items:center}
    .product-row input{width:72px}
    .product-title{font-weight:600}
    .summary-list{display:flex;flex-direction:column;gap:10px}
    .summary-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eee}
    .small-muted{font-size:12px;color:#777}
    footer{padding:12px;background:linear-gradient(180, transparent, #fff);position:sticky;bottom:0}
    .vendor{display:flex;gap:10px;align-items:center}
    .vendor img{width:48px;height:48px;border-radius:8px;object-fit:cover}
    .pill{padding:6px 10px;border-radius:999px;font-weight:700}
    .controls{display:flex;gap:8px}

    /* responsive touch targets */
    .big-btn, .system-item{touch-action:manipulation}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Crect width='120' height='120' fill='%231168a7' rx='16'/%3E%3Ctext x='50%' y='54%' font-size='36' text-anchor='middle' fill='%23fff' font-family='Arial' dy='.36em'%3EBF%3C/text%3E%3C/svg%3E" alt="Bio-Fix">
      <div>
        <h1>Pedidos Bio-Fix</h1>
        <div class="small">Pedidos r√°pidos ¬∑ m√≥vil</div>
      </div>
    </header>

    <div class="container">
      <!-- INICIO -->
      <section id="inicio" class="card">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
          <div style="flex:1">
            <div class="small-muted">Contacto de ventas</div>
            <div style="font-weight:700">Depto Ventas ¬∑ +54 9 11 6433-6112</div>
          </div>
          <div style="width:60px;text-align:right">
            <img src="https://via.placeholder.com/60x60.png?text=V" alt="vendedor" style="width:54px;height:54px;border-radius:8px;object-fit:cover">
          </div>
        </div>

        <button class="big-btn btn-primary" id="btnNuevo">Nuevo cliente</button>
        <button class="big-btn btn-outline spaced" id="btnFrecuente">Cliente frecuente</button>
      </section>

      <!-- FORMULARIO NUEVO CLIENTE -->
      <section id="formNuevo" class="card hidden">
        <div class="small-muted">Completa tus datos</div>
        <div class="spaced">
          <label>Nombre y apellido</label>
          <input type="text" id="inpNombre" placeholder="Ej: Juan P√©rez">
        </div>
        <div class="row spaced">
          <div class="col">
            <label>DNI</label>
            <input type="text" id="inpDni" placeholder="Sin puntos">
          </div>
          <div class="col">
            <label>CUIT</label>
            <input type="text" id="inpCuit" placeholder="XX-XXXXXXXX-X">
          </div>
        </div>
        <div class="row spaced">
          <div class="col">
            <label>Provincia</label>
            <select id="inpProvincia">
              <option value="">Seleccion√° provincia</option>
              <option>Buenos Aires</option>
              <option>Ciudad Aut√≥noma de Buenos Aires</option>
              <option>Catamarca</option>
              <option>Chaco</option>
              <option>Chubut</option>
              <option>C√≥rdoba</option>
              <option>Corrientes</option>
              <option>Entre R√≠os</option>
              <option>Formosa</option>
              <option>Jujuy</option>
              <option>La Pampa</option>
              <option>La Rioja</option>
              <option>Mendoza</option>
              <option>Misiones</option>
              <option>Neuqu√©n</option>
              <option>R√≠o Negro</option>
              <option>Salta</option>
              <option>San Juan</option>
              <option>San Luis</option>
              <option>Santa Cruz</option>
              <option>Santa Fe</option>
              <option>Santiago del Estero</option>
              <option>Tierra del Fuego</option>
              <option>Tucum√°n</option>
            </select>
          </div>
          <div class="col">
            <label>MP (matr√≠cula profesional)</label>
            <input type="text" id="inpMP" placeholder="Opcional">
          </div>
        </div>
        <div class="spaced">
          <label>Localidad</label>
          <input type="text" id="inpLocalidad" placeholder="Ej: Rosario">
        </div>

        <div class="spaced" style="display:flex;gap:8px">
          <button class="big-btn btn-outline" id="btnVolverInicio">‚¨ÖÔ∏è Volver</button>
          <button class="big-btn btn-primary" id="btnContinuar">‚û°Ô∏è Continuar</button>
        </div>
      </section>

      <!-- CATEGORIAS -->
      <section id="categorias" class="card hidden">
        <div class="small-muted">Agregar al pedido</div>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:10px">
          <button class="big-btn" id="catImplantes" style="background:var(--bg-gray);">Implantes</button>
          <button class="big-btn" id="catAnalogicos" style="background:var(--sys-analogicos);color:#fff">Componentes Anal√≥gicos</button>
          <button class="big-btn" id="catDigitales" style="background:var(--sys-digitales);color:#fff">Componentes Digitales</button>
          <button class="big-btn" id="catHerramental" style="background:var(--sys-herramental);color:#fff">Herramental</button>
        </div>

        <div class="spaced controls">
          <button class="big-btn btn-outline" id="btnVerResumen">üîç Ver resumen</button>
          <button class="big-btn btn-primary" id="btnFinalizar">‚úÖ Finalizar pedido</button>
        </div>
      </section>

      <!-- IMPLANTES: SISTEMAS -->
      <section id="implantes" class="card hidden">
        <div class="small-muted">Seleccion√° sistema</div>
        <div class="system-list spaced">
          <div class="system-item" data-sys="Monopieza" style="background:var(--sys-monopieza)">Monopieza</div>
          <div class="system-item" data-sys="Basal" style="background:var(--sys-basal)">Basal</div>
          <div class="system-item" data-sys="Compresivo Multiunit" style="background:var(--sys-compresivo)">Compresivo</div>
          <div class="system-item" data-sys="Hex√°gono Interno" style="background:var(--sys-hi)">Hex√°gono Int.</div>
          <div class="system-item" data-sys="Hex√°gono Externo" style="background:var(--sys-he)">Hex√°gono Ext.</div>
          <div class="system-item" data-sys="Cono Morse" style="background:var(--sys-conomorse)">Cono Morse</div>
        </div>
        <div class="spaced" style="display:flex;gap:8px">
          <button class="big-btn btn-outline" id="implantesAtras">‚¨ÖÔ∏è Atr√°s</button>
          <button class="big-btn btn-primary" id="implantesGuardar">üíæ Guardar</button>
        </div>

        <!-- lista de medidas dinamica -->
        <div id="implanteMedidas" class="spaced list-group"></div>
      </section>

      <!-- COMPONENTES ANALOGICOS/DIGITALES/HERRAM -->
      <section id="componentes" class="card hidden">
        <div class="small-muted" id="compTitle">Componentes</div>
        <div class="system-list spaced" id="compSystems"></div>

        <div class="spaced" style="display:flex;gap:8px">
          <button class="big-btn btn-outline" id="compAtras">‚¨ÖÔ∏è Atr√°s</button>
          <button class="big-btn btn-primary" id="compGuardar">üíæ Guardar</button>
        </div>

        <div id="compItems" class="spaced list-group"></div>
      </section>

      <!-- RESUMEN -->
      <section id="resumen" class="card hidden">
        <div class="small-muted">Resumen del pedido</div>
        <div class="summary-list spaced" id="resumenList"></div>
        <div class="spaced" style="display:flex;gap:8px">
          <button class="big-btn btn-outline" id="resumenAtras">‚¨ÖÔ∏è Volver</button>
          <button class="big-btn btn-primary" id="resumenFinalizar">‚úÖ Enviar por WhatsApp</button>
        </div>
      </section>

      <!-- FINALIZAR: Seleccionar vendedor -->
      <section id="finalizar" class="card hidden">
        <div class="small-muted">Eleg√≠ a qui√©n enviar</div>
        <div class="vendor spaced" style="align-items:flex-start">
          <img src="https://via.placeholder.com/80x80.png?text=V" alt="vendedor">
          <div>
            <div style="font-weight:800">Depto Ventas</div>
            <div class="small-muted">+54 9 11 6433-6112</div>
          </div>
        </div>
        <div class="spaced" style="display:flex;gap:8px">
          <button class="big-btn btn-outline" id="finalAtras">‚¨ÖÔ∏è Atr√°s</button>
          <button class="big-btn btn-primary" id="sendWpp">Abrir WhatsApp</button>
        </div>
      </section>

    </div>

    <footer>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small-muted">Items en carrito</div>
          <div id="cartCount" style="font-weight:800">0</div>
        </div>
        <div>
          <button class="big-btn btn-primary" id="irResumen">Ver resumen</button>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // --- Datos iniciales ---
    const PHONE = '5491164336112'; // formato wa.me sin + ni guiones

    const products = {
      "Implantes": {
    "Hex√°gono Interno": [
      "√ò3.0 x 6.5 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 16 mm",
      "√ò3.75 x 6.5 mm","√ò3.75 x 8 mm","√ò3.75 x 10 mm","√ò3.75 x 11.5 mm","√ò3.75 x 13 mm","√ò3.75 x 16 mm",
      "√ò4.2 x 6.5 mm","√ò4.2 x 8 mm","√ò4.2 x 10 mm","√ò4.2 x 11.5 mm","√ò4.2 x 13 mm","√ò4.2 x 16 mm",
      "√ò5.0 x 6.5 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm","√ò5.0 x 16 mm"
    ],
    "Hex√°gono Externo": {
      "√ò3.30 (Plataforma √ò3.4)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "√ò3.75 (Plataforma √ò4.1)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "√ò4.0 (Plataforma √ò4.1)": ["6 mm","8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "√ò5.0 (Plataforma √ò5.0)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"]
    },
    "Cono Morse": [
      "√ò3.30 x 8 mm","√ò3.30 x 10 mm","√ò3.0 x 11.5 mm","√ò3.30 x 13 mm","√ò3.30 x 16 mm",
      "√ò3.75 x 8 mm","√ò3.75 x 10 mm","√ò3.75 x 11.5 mm","√ò3.75 x 13 mm","√ò3.75 x 16 mm",
      "√ò4.2 x 8 mm","√ò4.2 x 10 mm","√ò4.2 x 11.5 mm","√ò4.2 x 13 mm","√ò4.2 x 16 mm",
      "√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm","√ò5.0 x 16 mm"
    ],
    "Monopieza": [
      "√ò3.0 x 6 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 15 mm","√ò3.0 x 18 mm","√ò3.0 x 20 mm",
      "√ò3.5 x 6 mm","√ò3.5 x 8 mm","√ò3.5 x 10 mm","√ò3.5 x 11.5 mm","√ò3.5 x 13 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 20 mm",
      "√ò4.0 x 6 mm","√ò4.0 x 8 mm","√ò4.0 x 10 mm","√ò4.0 x 11.5 mm","√ò4.0 x 13 mm","√ò4.0 x 15 mm","√ò4.0 x 18 mm","√ò4.0 x 20 mm",
      "√ò4.5 x 6 mm","√ò4.5 x 8 mm","√ò4.5 x 10 mm","√ò4.5 x 11.5 mm","√ò4.5 x 13 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 20 mm",
      "√ò5.0 x 6 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm",
      "√ò5.5 x 6 mm","√ò5.5 x 8 mm","√ò5.5 x 10 mm","√ò5.5 x 11.5 mm","√ò5.5 x 13 mm"
    ],
    "Monopieza Basal": {
      "Pulido": [
        "√ò3.5 x 10 mm","√ò3.5 x 12 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 21 mm","√ò3.5 x 23 mm","√ò3.5 x 24 mm","√ò3.5 x 26 mm","√ò3.5 x 28 mm","√ò3.5 x 24 mm C14","√ò3.5 x 26 mm C16","√ò3.5 x 28 mm C18",
        "√ò4.5 x 10 mm","√ò4.5 x 12 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 21 mm","√ò4.5 x 23 mm","√ò4.5 x 24 mm","√ò4.5 x 26 mm","√ò4.5 x 28 mm","√ò4.5 x 24 mm C14","√ò4.5 x 26 mm C15","√ò4.5 x 28 mm C18",
        "√ò5.5 x 10 mm","√ò5.5 x 12 mm","√ò5.5 x 15 mm","√ò5.5 x 18 mm",
        "√ò6.5 x 10 mm","√ò6.5 x 12 mm","√ò6.5 x 15 mm",
        "√ò8.5 x 10 mm","√ò8.5 x 12 mm","√ò8.5 x 15 mm"
      ],
      "Tratamiento superficial": [
        "√ò3.5 x 10 mm","√ò3.5 x 12 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 21 mm","√ò3.5 x 23 mm","√ò3.5 x 24 mm","√ò3.5 x 26 mm","√ò3.5 x 28 mm","√ò3.5 x 24 mm C14","√ò3.5 x 26 mm C16","√ò3.5 x 28 mm C18",
        "√ò4.5 x 10 mm","√ò4.5 x 12 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 21 mm","√ò4.5 x 23 mm","√ò4.5 x 24 mm","√ò4.5 x 26 mm","√ò4.5 x 28 mm","√ò4.5 x 24 mm C14","√ò4.5 x 26 mm C15","√ò4.5 x 28 mm C18",
        "√ò5.5 x 10 mm","√ò5.5 x 12 mm","√ò5.5 x 15 mm","√ò5.5 x 18 mm",
        "√ò6.5 x 10 mm","√ò6.5 x 12 mm","√ò6.5 x 15 mm",
        "√ò8.5 x 10 mm","√ò8.5 x 12 mm","√ò8.5 x 15 mm"
      ]
    },
    "Compresivo Multiunit": [
      "√ò3.0 x 6 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 15 mm","√ò3.0 x 18 mm","√ò3.0 x 20 mm",
      "√ò3.5 x 6 mm","√ò3.5 x 8 mm","√ò3.5 x 10 mm","√ò3.5 x 11.5 mm","√ò3.5 x 13 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 20 mm",
      "√ò4.0 x 6 mm","√ò4.0 x 8 mm","√ò4.0 x 10 mm","√ò4.0 x 11.5 mm","√ò4.0 x 13 mm","√ò4.0 x 15 mm","√ò4.0 x 18 mm","√ò4.0 x 20 mm",
      "√ò4.5 x 6 mm","√ò4.5 x 8 mm","√ò4.5 x 10 mm","√ò4.5 x 11.5 mm","√ò4.5 x 13 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 20 mm",
      "√ò5.0 x 6 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm",
      "√ò5.5 x 6 mm","√ò5.5 x 8 mm","√ò5.5 x 10 mm","√ò5.5 x 11.5 mm","√ò5.5 x 13 mm"
    ]
  },
  "Componentes Anal√≥gicos": {
    "Hex√°gono Interno": {
      "Ucla Calcinable": ["Rotacional","Anti-Rotacional"],
      "An√°logo de Titanio": [],
      "BallAttach y Cazoleta": ["H1","H2","H3","H4"],
      "Tapa de cicatrizaci√≥n": ["H1","H2","H3","H4"],
      "Transfer cubeta": ["Abierta","Cerrada"],
      "Pilar recto c/tornillo": ["H1","H2","H3","H4"],
      "Minipilar Angulado H.I + Llave transportadora + tornillo": ["1.5mm","2.5mm","3.5mm"],
      "Pilar angulado c/tornillo": ["15¬∞","25¬∞"]
    },
    "Hex√°gono Externo": {
      "Ucla calcinable": {
        "Rotacional": {
          "Plat √ò3.4": ["H1","H2","H3","H4"],
          "Plat √ò4.1": ["H1","H2","H3","H4"],
          "Plat √ò5.0": ["H1","H2","H3","H4"]
        },
        "Anti-rotacional": {
          "Plat √ò3.4": ["H1","H2","H3","H4"],
          "Plat √ò4.1": ["H1","H2","H3","H4"],
          "Plat √ò5.0": ["H1","H2","H3","H4"]
        }
      },
      "Tapa de cicatrizaci√≥n": {
        "Plat √ò3.4": ["H1","H2","H3"],
        "Plat √ò4.1": ["H1","H2","H3"],
        "Plat √ò5.0": ["H1","H2","H3"]
      },
      "Transfer cubeta": {
        "Plat √ò3.4": ["Abierta","Cerrada"],
        "Plat √ò4.1": ["Abierta","Cerrada"],
        "Plat √ò5.0": ["Abierta","Cerrada"]
      },
      "Ball attach": {
        "Plat √ò3.4": ["H1","H2","H3","H4"],
        "Plat √ò4.1": ["H1","H2","H3","H4"],
        "Plat √ò5.0": ["H1","H2","H3","H4"]
      },
      "Pilar recto c/tornillo": {
        "Plat √ò3.4": {"H1-H3": ["Hexagonal","Cuadrado"]},
        "Plat √ò4.1": {"H1-H3": ["Hexagonal","Cuadrado"]},
        "Plat √ò5.0": {"H1-H3": ["Hexagonal","Cuadrado"]}
      },
      "Tornillo prot√©sico": ["Cuadrado","Hexagonal"],
      "Pilar angulado c/tornillo": {"Plat √ò4.1": ["15¬∞","25¬∞"]}
    },
    "Cono Morse": {
      "Pilares est√°ndar": {
        "√ò3.3": ["√ò3.3x0.8x4","√ò3.3x1.5x4","√ò3.3x2.5x4","√ò3.3x3.5x4","√ò3.3x4.5x4","√ò3.3x5.5x4","√ò3.3x0.8x6","√ò3.3x1.5x6","√ò3.3x2.5x6","√ò3.3x3.5x6","√ò3.3x4.5x6","√ò3.3x5.5x6"],
        "√ò4.5": ["√ò4.5x0.8x4","√ò4.5x1.5x4","√ò4.5x2.5x4","√ò4.5x3.5x4","√ò4.5x4.5x4","√ò4.5x5.5x4","√ò4.5x0.8x6","√ò4.5x1.5x6","√ò4.5x2.5x6","√ò4.5x3.5x6","√ò4.5x4.5x6","√ò4.5x5.5x6"]
      },
      "Pilares c/tornillo pasante": {
        "√ò3.3": ["√ò3.3x0.8x4","√ò3.3x1.5x4","√ò3.3x2.5x4","√ò3.3x3.5x4","√ò3.3x4.5x4","√ò3.3x5.5x4","√ò3.3x0.8x6","√ò3.3x1.5x6","√ò3.3x2.5x6","√ò3.3x3.5x6","√ò3.3x4.5x6","√ò3.3x5.5x6"],
        "√ò4.5": ["√ò4.5x0.8x4","√ò4.5x1.5x4","√ò4.5x2.5x4","√ò4.5x3.5x4","√ò4.5x4.5x4","√ò4.5x5.5x4","√ò4.5x0.8x6","√ò4.5x1.5x6","√ò4.5x2.5x6","√ò4.5x3.5x6","√ò4.5x4.5x6","√ò4.5x5.5x6"]
      },
      "Pilares de cicatrizaci√≥n": {"√ò3.3":["H1.5","H2.5","H3.5"],"√ò4.5":["H1.5","H2.5","H3.5"]},
      "An√°logo Universal": [],
      "BallAttach y Cazoleta": ["H1.5","H2.5","H3.5","H4.5","H5.5"]
    },
    "Monopieza": {
      "An√°logo": [],
      "Ucla Calcinable": ["√ò3.0","√ò3.5","√ò4.0","√ò4.5","√ò5.0"],
      "Transfer Rotacional": []
    },
    "Compresivo Multiunit": {
      "Transfer Cubeta Abierta": [],
      "Cicatrizal c/tornillo": ["H2","H3","H4"],
      "Ballattach y cazoleta": ["H2","H3","H4"],
      "Pilar Recto c/tornillo": []
    }
  },
  "Componentes Digitales": {
    "Hex√°gono Interno": {
      "Analogo Digital": ["√önico"],
      "T-Base": ["Rotacional √ò4.3","No Rotacional √ò4.3"],
      "Cuerpo Escaneo": ["√önico"]
    },
    "Hex√°gono Externo": {
      "Analogo Digital": ["Plat √ò3.4","Plat √ò4.1","Plat √ò5.0"],
      "T-Base": ["Plat √ò3.4 Rot","Plat √ò4.1 Rot","Plat √ò5.0 Rot","Plat √ò3.4 Not Rot","Plat √ò4.1 Not Rot","Plat √ò5.0 Not Rot"],
      "Cuerpo Escaneo": ["Plat √ò3.4","Plat √ò4.1","Plat √ò5.0"]
    },
    "Cono Morse": {
      "Analogo Digital": ["√önico"],
      "T-Base": ["√önico"],
      "Cuerpo Escaneo": ["√önico"]
    },
    "Compresivo Multiunit": {
      "Analogo Digital": ["√önico"],
      "T-Base": ["√önico"],
      "Cuerpo Escaneo": ["√önico"]
    },
    "Multiunit": {
      "Hex√°gono Interno": {"Plataforma √önica √ò3.75 mm":["H1","H2","H3","H4","H5"]},
      "Hex√°gono Externo": {"Plataforma √ò4.1 mm":["H1","H2","H3","H4","H5"]},
      "Cono Morse": {"Plataforma Switch":["H0.8","H1.5","H2.5","H3.5","H4.5","H5.5"]}
    }
  },
  "Herramental": {
    "Fresa Lanza": ["Corta","Larga"],
    "Fresa Lanza Guiada": ["Corta","Larga"],
    "Fresa Helicoidal": ["√ò2.0","√ò2.5","√ò2.8","√ò3.2","√ò3.6","√ò4.0","√ò4.3","√ò4.6","√ò5.0","√ò5.3"],
    "Kit 3 Expansores de Hueso": [],
    "Kit 3 Expansores de Hueso - Monopieza": [],
    "Torquimetro Dinamometrico": [],
    "Mango Rigido": [],
    "Mango para angulacion de Pilar MP": [],
    "Extractor de Raiz residual": [],
    "Driver Retractil": [],
    "Punta Driver para Monopieza": ["Larga","Corta"],
    "Llave conectora para contrangulo MP": ["Larga","Corta"],
    "Destornillador Digital Cuadrado": ["Corto 0.050","Est√°ndar 0.050","Largo 0.050","Extra Largo 0.050"],
    "Destornillador Digital Hexagonal": ["Corto 0.048","Estandar 0.048","Largo 0.048","Extra Largo 0.048"],
    "Destornillador Cuadrado p/Torqu√≠metro": ["Corto 0.050","Est√°ndar 0.050","Largo 0.050","Extra Largo 0.050"],
    "Destornillador Hexagonal p/Torqu√≠metro": ["Corto 0.048","Estandar 0.048","Largo 0.048","Extra Largo 0.048"],
    "Prolongador de Fresa": [],
    "Prolongador 4x4": ["Corto","Largo"],
    "Conctor para torqu√≠metro CMHI": [],
    "Punch": ["3.4mm","4.1mm","5.0mm"],
    "Anilla para Guia": ["√ò5,5-√ò2,1","√ò5,5-√ò4,2","√ò4,1-√ò3,0"],
    "Llave conectora Monopieza": ["Corta","Larga"],
    "Llave conectora CMU": ["Corta","Larga"]
  }
};

    // carrito
    let cliente = null;
    let cart = [];

    // util
    const $ = (id) => document.getElementById(id);
    const show = (id)=>{document.querySelectorAll('section').forEach(s=>s.classList.add('hidden')); $(id).classList.remove('hidden'); window.scrollTo(0,0)}
    const updateCartCount = ()=>{$('cartCount').innerText = cart.reduce((s,i)=>s+i.qty,0)}

    // inicio
    $('btnNuevo').addEventListener('click',()=>show('formNuevo'));
    $('btnFrecuente').addEventListener('click',()=>{cliente = {name:'Cliente frecuente'}; show('categorias')});
    $('btnVolverInicio').addEventListener('click',()=>show('inicio'));
    $('btnContinuar').addEventListener('click',()=>{
      const nombre = $('inpNombre').value.trim();
      if(!nombre){alert('Ingres√° nombre y apellido');return}
      cliente = {
        name:nombre,
        dni:$('inpDni').value.trim(),
        cuit:$('inpCuit').value.trim(),
        provincia:$('inpProvincia').value,
        mp:$('inpMP').value.trim(),
        localidad:$('inpLocalidad').value.trim()
      };
      show('categorias');
    });

    // categorias
    $('catImplantes').addEventListener('click',()=>{prepareImplantes(); show('implantes')});
    $('catAnalogicos').addEventListener('click',()=>{prepareComponentes('Componentes Anal√≥gicos'); show('componentes')});
    $('catDigitales').addEventListener('click',()=>{prepareComponentes('Componentes Digitales'); show('componentes')});
    $('catHerramental').addEventListener('click',()=>{prepareComponentes('Herramental'); show('componentes')});

    $('btnVerResumen').addEventListener('click',()=>{renderResumen(); show('resumen')});
    $('btnFinalizar').addEventListener('click',()=>{renderResumen(); show('finalizar')});
    $('irResumen').addEventListener('click',()=>{renderResumen(); show('resumen')});

    // IMPLANTES
    let selectedImplanteSys = null;
    function prepareImplantes(){
      const cont = $('implanteMedidas'); cont.innerHTML=''; selectedImplanteSys=null;
      // sistemas ya est√°n en HTML como botones con data-sys; attach
      document.querySelectorAll('#implantes .system-item').forEach(el=>{
        el.onclick = ()=>{
          selectedImplanteSys = el.dataset.sys;
          renderImplanteMedidas(selectedImplanteSys);
        }
      });
    }

    function renderImplanteMedidas(sys){
      const lista = products.Implantes[sys] || [];
      const cont = $('implanteMedidas'); cont.innerHTML='';
      lista.forEach(p=>{
        const row = document.createElement('div'); row.className='product-row';
        row.innerHTML = `<div style="flex:1"><div class='product-title'>${p}</div><div class='small-muted'>Sistema: ${sys}</div></div><div style='width:110px;display:flex;gap:6px;align-items:center'><input type='number' min='0' value='0' data-prod='${escapeHtml(p)}' class='qty' /><button class='btn-outline' data-add='${escapeHtml(p)}'>Agregar</button></div>`
        cont.appendChild(row);
      });
      // wire add buttons
      cont.querySelectorAll('[data-add]').forEach(b=>b.onclick = (e)=>{
        const prod = b.getAttribute('data-add');
        const qty = parseInt(b.parentElement.querySelector('.qty').value)||0;
        if(qty<=0){alert('Ingres√° cantidad mayor a 0');return}
        cart.push({cat:'Implantes', system:sys, name:unescapeHtml(prod), qty:qty}); updateCartCount();
        // reset qty to 0
        b.parentElement.querySelector('.qty').value = 0;
        alert('Producto agregado');
      });
    }

    $('implantesAtras').addEventListener('click',()=>show('categorias'));
    $('implantesGuardar').addEventListener('click',()=>{renderResumen(); show('categorias')});

    // COMPONENTES
    let currentCompCategory = null; // 'Componentes Anal√≥gicos' etc
    function prepareComponentes(cat){
      currentCompCategory = cat;
      $('compTitle').innerText = cat;
      const systems = Object.keys(products[cat]||{});
      const sysCont = $('compSystems'); sysCont.innerHTML='';
      systems.forEach(s=>{
        const div = document.createElement('div'); div.className='system-item'; div.dataset.sys=s; div.innerText=s;
        // color by system mapping
        div.style.background = mapSysColor(s);
        sysCont.appendChild(div);
        div.onclick = ()=>{
          renderCompItems(cat,s);
        }
      });
      $('compItems').innerHTML='';
    }

    function renderCompItems(cat,sys){
      const lista = products[cat][sys]||[];
      const cont = $('compItems'); cont.innerHTML='';
      lista.forEach(p=>{
        const row = document.createElement('div'); row.className='product-row';
        row.innerHTML = `<div style="flex:1"><div class='product-title'>${p}</div><div class='small-muted'>Sistema: ${sys}</div></div><div style='width:110px;display:flex;gap:6px;align-items:center'><input type='number' min='0' value='0' data-prod='${escapeHtml(p)}' class='qty' /><button class='btn-outline' data-add='${escapeHtml(p)}'>Agregar</button></div>`
        cont.appendChild(row);
      });
      cont.querySelectorAll('[data-add]').forEach(b=>b.onclick = ()=>{
        const prod = b.getAttribute('data-add');
        const qty = parseInt(b.parentElement.querySelector('.qty').value)||0;
        if(qty<=0){alert('Ingres√° cantidad mayor a 0');return}
        cart.push({cat:cat, system:sys, name:unescapeHtml(prod), qty:qty}); updateCartCount();
        b.parentElement.querySelector('.qty').value = 0;
        alert('Producto agregado');
      });
    }

    $('compAtras').addEventListener('click',()=>show('categorias'));
    $('compGuardar').addEventListener('click',()=>{renderResumen(); show('categorias')});

    // RESUMEN
    function renderResumen(){
      const list = $('resumenList'); list.innerHTML='';
      if(cart.length===0){ list.innerHTML = '<div class="small-muted">No hay productos en el pedido.</div>'; return }
      cart.forEach((it,idx)=>{
        const div = document.createElement('div'); div.className='summary-item';
        div.innerHTML = `<div><div style='font-weight:800'>${it.name}</div><div class='small-muted'>${it.cat} ¬∑ ${it.system || ''}</div></div><div style='display:flex;flex-direction:column;gap:6px;align-items:flex-end'><div style='font-weight:800'>x ${it.qty}</div><div style='display:flex;gap:6px'><button data-del='${idx}' class='btn-outline'>Eliminar</button><button data-edit='${idx}' class='btn-outline'>Editar</button></div></div>`
        list.appendChild(div);
      });
      // attach handlers
      list.querySelectorAll('[data-del]').forEach(b=>b.onclick=()=>{ const i=parseInt(b.getAttribute('data-del')); cart.splice(i,1); renderResumen(); updateCartCount(); });
      list.querySelectorAll('[data-edit]').forEach(b=>b.onclick=()=>{ const i=parseInt(b.getAttribute('data-edit')); const newQty = prompt('Modificar cantidad', cart[i].qty); if(newQty!==null){ const n = parseInt(newQty)||0; if(n<=0){alert('Cantidad inv√°lida');return} cart[i].qty=n; renderResumen(); updateCartCount(); }});
    }

    $('resumenAtras').addEventListener('click',()=>show('categorias'));
    $('resumenFinalizar').addEventListener('click',()=>show('finalizar'));

    // FINALIZAR
    $('finalAtras').addEventListener('click',()=>show('resumen'));
    $('sendWpp').addEventListener('click',sendWhatsApp);

    function sendWhatsApp(){
      if(cart.length===0){alert('El pedido est√° vac√≠o');return}
      // build text
      const lines = [];
      lines.push('üßæ *Nuevo Pedido - Bio-Fix*');
      if(cliente) lines.push(`üë§ Cliente: ${cliente.name || ''}`);
      if(cliente && cliente.localidad) lines.push(`üìç Localidad: ${cliente.localidad}${cliente.provincia?(', '+cliente.provincia):''}`);
      if(cliente && cliente.dni) lines.push(`üÜî DNI: ${cliente.dni}`);
      lines.push('');
      lines.push('*Detalles del pedido:*');
      cart.forEach(it=>{
        lines.push(`- ${it.name} (${it.system}) x ${it.qty}`);
      });
      lines.push('');
      lines.push(`üì¶ Total de √≠tems: ${cart.reduce((s,i)=>s+i.qty,0)}`);
      const text = encodeURIComponent(lines.join('\n'));
      const url = `https://wa.me/${PHONE}?text=${text}`;
      window.open(url,'_blank');
    }

    // COMPONENT HELPERS
    function mapSysColor(sys){
      const map = {
        'Monopieza':'var(--sys-monopieza)','Basal':'var(--sys-basal)','Compresivo Multiunit':'var(--sys-compresivo)','Hex√°gono Interno':'var(--sys-hi)','Hex√°gono Externo':'var(--sys-he)','Cono Morse':'var(--sys-conomorse)'
      };
      return map[sys] || 'var(--bg-gray)';
    }

    function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
    function unescapeHtml(str){ return String(str).replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"'); }

    // init
    show('inicio');
  </script>
</body>
</html>