<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedido Bio-Fix</title>
<style>
body { font-family: Arial, sans-serif; padding: 15px; background: #f4f4f4; }
h2,h3{text-align:center;margin-bottom:10px;}
.section{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;display:none;}
.item{display:flex;flex-direction:column;gap:10px;margin-bottom:10px;}
select,input{padding:10px;font-size:16px;width:100%;}
button{background:#25d366;color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;margin-top:10px;font-size:16px;}
button:hover{background:#1ebe5c;}
.nota-seguridad{font-size:12px;color:#555;text-align:center;margin-top:10px;}
#resumenPedido{white-space:pre-line; background:#eee; padding:10px; border-radius:8px;}
</style>
</head>
<body>

<h2>Formulario de Pedido Bio-Fix</h2>

<!-- SECCI√ìN 1: DATOS ODONT√ìLOGO -->
<div class="section" id="datos-section" style="display:block;">
<h3>Datos del odont√≥logo</h3>
<input type="text" placeholder="Nombre" id="nombre">
<input type="text" placeholder="Apellido" id="apellido">
<input type="text" placeholder="DNI" id="dni">
<input type="text" placeholder="Matr√≠cula profesional" id="matricula">
<select id="provincia">
<option value="">Seleccionar provincia</option>
<option>Buenos Aires</option>
<option>C√≥rdoba</option>
<option>Santa Fe</option>
<option>Mendoza</option>
<option>Entre R√≠os</option>
</select>
<input type="text" placeholder="Localidad" id="localidad">
<button id="btnSiguienteDatos" style="display:none;">Siguiente</button>
</div>

<!-- SECCI√ìN 2: CATEGOR√çAS -->
<div class="section" id="categorias-section">
<h3>Selecciona categor√≠a</h3>
<button onclick="mostrarProductos('Implantes')">Implantes</button>
<button onclick="mostrarProductos('Componentes Anal√≥gicos')">Componentes Anal√≥gicos</button>
<button onclick="mostrarProductos('Herramental')">Herramental</button>
<button onclick="volverADatos()">Volver</button>
</div>

<!-- SECCI√ìN 3: PRODUCTOS -->
<div class="section" id="productos-section">
<h3 id="tituloProductos">Productos</h3>
<div id="productos-list"></div>
<button onclick="agregarProducto()">+ Agregar Producto</button>
<button onclick="guardarProductos()">Guardar y volver a Categor√≠as</button>
<button onclick="mostrarResumen()">Ver Pedido</button>
<button onclick="volverACategorias()">Volver</button>
</div>

<!-- SECCI√ìN 4: RESUMEN -->
<div class="section" id="resumen-section">
<h3>Resumen del Pedido</h3>
<div id="resumenPedido"></div>
<button onclick="enviarPedido()">Enviar por WhatsApp</button>
<button onclick="volverAProductos()">Volver</button>
</div>

<p class="nota-seguridad">üîí Tu informaci√≥n se procesa de forma segura.</p>

<script>
// --- DATOS ODONT√ìLOGO ---
const campos = ["nombre","apellido","dni","matricula","provincia","localidad"];
const btnSiguienteDatos = document.getElementById("btnSiguienteDatos");

campos.forEach(id => {
  const el = document.getElementById(id);
  if(el.tagName === "SELECT"){
    el.addEventListener("change", validarDatos);
  } else {
    el.addEventListener("input", validarDatos);
  }
});

function validarDatos(){
  const completos = campos.every(c=>{
    const val = document.getElementById(c).value.trim();
    return val !== "";
  });
  btnSiguienteDatos.style.display = completos ? "block" : "none";
}

btnSiguienteDatos.addEventListener("click", ()=>{
  document.getElementById("datos-section").style.display="none";
  document.getElementById("categorias-section").style.display="block";
});

// --- VOLVER ---
function volverADatos(){ document.getElementById("categorias-section").style.display="none"; document.getElementById("datos-section").style.display="block"; }
function volverACategorias(){ document.getElementById("productos-section").style.display="none"; document.getElementById("categorias-section").style.display="block"; }
function volverAProductos(){ document.getElementById("resumen-section").style.display="none"; document.getElementById("productos-section").style.display="block"; }

// --- CATALOGO ---
const catalogo = {
"Implantes": {
  "Hex√°gono Interno": ["√ò3.0 x 6.5 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 16 mm",
                       "√ò3.75 x 6.5 mm","√ò3.75 x 8 mm","√ò3.75 x 10 mm","√ò3.75 x 11.5 mm","√ò3.75 x 13 mm","√ò3.75 x 16 mm",
                       "√ò4.2 x 6.5 mm","√ò4.2 x 8 mm","√ò4.2 x 10 mm","√ò4.2 x 11.5 mm","√ò4.2 x 13 mm","√ò4.2 x 16 mm",
                       "√ò5.0 x 6.5 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm","√ò5.0 x 16 mm"],
  "Hex√°gono Externo": {
    "√ò3.30 (Plataforma √ò3.4)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
    "√ò3.75 (Plataforma √ò4.1)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
    "√ò4.0 (Plataforma √ò4.1)": ["6 mm","8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
    "√ò5.0 (Plataforma √ò5.0)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"]
  },
  "Cono Morse": ["√ò3.0 x 6 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 16 mm",
                       "√ò3.0 x 6 mm","√ò3.5 x 8 mm","√ò3.75 x 10 mm","√ò3.75 x 11.5 mm","√ò3.75 x 13 mm","√ò3.75 x 16 mm",
                       "√ò4.2 x 8 mm","√ò4.2 x 10 mm","√ò4.2 x 11.5 mm","√ò4.2 x 13 mm","√ò4.2 x 16 mm",
                       "√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm","√ò5.0 x 16 mm"],
  "Monopieza": ["√ò3.0 x 6 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 15 mm","√ò3.0 x 18 mm","√ò3.0 x 20 mm",
                       "√ò3.5 x 6 mm","√ò3.5 x 8 mm","√ò3.5 x 10 mm","√ò3.5 x 11.5 mm","√ò3.5 x 13 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 20 mm",
                       "√ò4.0 x 6 mm","√ò4.0 x 8 mm","√ò4.0 x 10 mm","√ò4.0 x 11.5 mm","√ò4.0 x 13 mm","√ò4.0 x 15 mm","√ò4.0 x 18 mm","√ò4.0 x 20 mm",
                       "√ò4.5 x 6 mm","√ò4.5 x 8 mm","√ò4.5 x 10 mm","√ò4.5 x 11.5 mm","√ò4.5 x 13 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 20 mm",
                       "√ò5.0 x 6 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm",
                       "√ò5.5 x 6 mm","√ò5.5 x 8 mm","√ò5.5 x 10 mm","√ò5.5 x 11.5 mm","√ò5.5 x 13 mm"],
  "Monopieza Basal": ["√ò3.5 x 10 mm","√ò3.5 x 12 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 21 mm","√ò3.5 x 23 mm","√ò3.5 x 24 mm","√ò3.5 x 26 mm","√ò3.5 x 28 mm","√ò3.5 x 24 mm C14","√ò3.5 x 26 mm C16","√ò3.5 x 28 mm C18",
                       "√ò4.5 x 10 mm","√ò4.5 x 12 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 21 mm","√ò4.5 x 23 mm","√ò4.5 x 24 mm","√ò4.5 x 26 mm","√ò4.5 x 28 mm","√ò4.5 x 24 mm C14","√ò4.5 x 26 mm C16","√ò4.5 x 28 mm C18",
                       "√ò5.5 x 10 mm","√ò4.5 x 12 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm",
                       "√ò6.5 X 10 mm","√ò6.5 x 12 mm","√ò6.5 x 15 mm",
                       "√ò8.5 X 10 mm","√ò8.5 x 12 mm","√ò8.5 x 15 mm",],
  "Compresivo Multiunit": ["√ò3.75 x 10 mm","√ò4.0 x 13 mm"]
},
"Componentes Anal√≥gicos": {
  "Hex√°gono Interno": {
    "Tapa de cicatrizaci√≥n":["H1","H2","H3","H4"],
    "Transfer cubeta":["Abierta","Cerrada"],
    "Pilar recto c/tornillo":["H1","H2","H3","H4"],
    "Pilar angulado c/tornillo":["15¬∞","25¬∞"]
  }
},
"Herramental": {
  "Fresa Lanza":["Corta","Larga"],
  "Fresa Lanza Guiada":["Corta","Larga"],
  "Fresa Helicoidal":["√ò2.0","√ò2.5","√ò2.8","√ò3.2","√ò3.6","√ò4.0","√ò4.3","√ò4.6","√ò5.0","√ò5.3"]
}
};

// --- Productos sin medida (solo opciones fijas) ---
const sinMedida = ["Fresa Lanza","Fresa Lanza Guiada"];

// --- GUARDAR DATOS SELECCIONADOS ---
let datosSeleccionados = { "Implantes":[], "Componentes Anal√≥gicos":[], "Herramental":[] };
let categoriaActual = "";

// --- FUNCIONES ---
function mostrarProductos(categoria){
  categoriaActual = categoria;
  document.getElementById("categorias-section").style.display="none";
  document.getElementById("productos-section").style.display="block";
  document.getElementById("tituloProductos").innerText = categoria;
  cargarProductosGuardados();
}

function agregarProducto(){
  const lista = document.getElementById("productos-list");
  const div = document.createElement("div");
  div.classList.add("item");

  const selectProducto = document.createElement("select");
  selectProducto.innerHTML = "<option value=''>Seleccionar producto</option>";
  for(let p in catalogo[categoriaActual]){
    selectProducto.innerHTML += `<option value="${p}">${p}</option>`;
  }

  const selectSubtipo = document.createElement("select");
  selectSubtipo.style.display="none";

  const selectMedida = document.createElement("select");
  selectMedida.style.display="none";

  const inputCantidad = document.createElement("input");
  inputCantidad.type="number";
  inputCantidad.min="1";
  inputCantidad.placeholder="Cantidad";
  inputCantidad.style.display="none";

  selectProducto.addEventListener("change", ()=>{ manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });
  selectSubtipo.addEventListener("change", ()=>{ manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });

  div.appendChild(selectProducto);
  div.appendChild(selectSubtipo);
  div.appendChild(selectMedida);
  div.appendChild(inputCantidad);
  lista.appendChild(div);
}

function manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad){
  const p = catalogo[categoriaActual][selectProducto.value];

  selectSubtipo.style.display = "none";
  selectMedida.style.display = "none";
  inputCantidad.style.display = "none";
  selectSubtipo.innerHTML = "";
  selectMedida.innerHTML = "";

  if(!p) return;

  // Productos sin medida ‚Üí mostrar directamente opciones
  if(sinMedida.includes(selectProducto.value)){
    selectSubtipo.style.display = "block";
    selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
    p.forEach(o => selectSubtipo.innerHTML += `<option value="${o}">${o}</option>`);
    inputCantidad.style.display = "block";
    return;
  }

  // Si es array ‚Üí medidas
  if(Array.isArray(p)){
    selectMedida.style.display = "block"; 
    selectMedida.innerHTML = "<option value=''>Seleccionar</option>";
    p.forEach(m=>selectMedida.innerHTML+=`<option value="${m}">${m}</option>`); 
    inputCantidad.style.display = "block"; 
  }
  // Si es objeto ‚Üí subtipo con medidas
  else if(typeof p === "object"){
    selectSubtipo.style.display = "block";
    selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
    for(let s in p){ selectSubtipo.innerHTML += `<option value="${s}">${s}</option>`; }
  }
}

function manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad){
  const p = catalogo[categoriaActual][selectProducto.value];
  const medidas = p[selectSubtipo.value];
  selectMedida.innerHTML = "<option value=''>Seleccionar</option>";
  if(medidas && medidas.length>0){ 
    selectMedida.style.display="block"; 
    medidas.forEach(m=>selectMedida.innerHTML+=`<option value="${m}">${m}</option>`); 
  } else { 
    selectMedida.style.display="none"; 
  }
  inputCantidad.style.display="block";
}

function cargarProductosGuardados(){
  const lista = document.getElementById("productos-list");
  lista.innerHTML="";
  datosSeleccionados[categoriaActual].forEach(item=>{
    const div = document.createElement("div");
    div.classList.add("item");

    const selectProducto = document.createElement("select");
    selectProducto.innerHTML = "<option value=''>Seleccionar producto</option>";
    for(let p in catalogo[categoriaActual]){ selectProducto.innerHTML += `<option value="${p}" ${p===item.producto?'selected':''}>${p}</option>`; }

    const selectSubtipo = document.createElement("select");
    selectSubtipo.style.display=item.subtipo?"block":"none";
    if(item.subtipo){
      const opciones = catalogo[categoriaActual][item.producto];
      if(Array.isArray(opciones)){
        selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
        opciones.forEach(o=>selectSubtipo.innerHTML+=`<option value="${o}" ${o===item.subtipo?'selected':''}>${o}</option>`);
      } else if(typeof opciones==="object"){
        selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
        for(let s in opciones){ selectSubtipo.innerHTML += `<option value="${s}" ${s===item.subtipo?'selected':''}>${s}</option>`; }
      }
    }

    const selectMedida = document.createElement("select");
    selectMedida.style.display=item.medida?"block":"none";
    if(item.medida) selectMedida.innerHTML=`<option value="${item.medida}" selected>${item.medida}</option>`;

    const inputCantidad = document.createElement("input");
    inputCantidad.type="number";
    inputCantidad.min="1";
    inputCantidad.placeholder="Cantidad";
    inputCantidad.value=item.cantidad || "";
    inputCantidad.style.display="block";

    selectProducto.addEventListener("change", ()=>{ manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });
    selectSubtipo.addEventListener("change", ()=>{ manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });

    div.appendChild(selectProducto);
    div.appendChild(selectSubtipo);
    div.appendChild(selectMedida);
    div.appendChild(inputCantidad);
    lista.appendChild(div);
  });
}

function guardarProductos(){
  const lista = document.querySelectorAll("#productos-list .item");
  datosSeleccionados[categoriaActual] = [];
  lista.forEach(item=>{
    const producto = item.querySelector("select:nth-child(1)").value;
    const subtipo = item.querySelector("select:nth-child(2)").value;
    const medida = item.querySelector("select:nth-child(3)").value;
    const cantidad = item.querySelector("input").value;
    if(producto && cantidad){ datosSeleccionados[categoriaActual].push({producto,subtipo,medida,cantidad}); }
  });
  document.getElementById("productos-section").style.display="none";
  document.getElementById("categorias-section").style.display="block";
}

function mostrarResumen(){
  guardarProductos(); 
  const resumenDiv = document.getElementById("resumenPedido");
  resumenDiv.innerHTML="";

  // Construir texto del resumen para mostrar
  let textoResumen = "";
  for(let cat in datosSeleccionados){
    if(datosSeleccionados[cat].length>0){
      textoResumen += `${cat}:\n`;
      datosSeleccionados[cat].forEach(item=>{
        textoResumen += `- ${item.producto}${item.subtipo?' - '+item.subtipo:''}${item.medida?' : '+item.medida:''} x${item.cantidad}\n`;
      });
    }
  }

  resumenDiv.innerText = textoResumen;

  // Botones para cada vendedor
  const vendedores = [
    {nombre:"Vendedor 1", numero:"5491134019090"},
    {nombre:"Vendedor 2", numero:"5491164336112"}
  ];

  const botonesDiv = document.createElement("div");
  botonesDiv.style.marginTop="10px";
  botonesDiv.style.display="flex";
  botonesDiv.style.flexDirection="column";
  botonesDiv.style.gap="5px";

  vendedores.forEach(vendedor => {
    const btn = document.createElement("button");
    btn.textContent = `Enviar a ${vendedor.nombre}`;
    btn.style.width="200px";
    btn.style.alignSelf="center";
    btn.onclick = () => {
      // Generar mensaje directamente desde los datos
      const nombre = document.getElementById("nombre").value;
      const apellido = document.getElementById("apellido").value;
      const dni = document.getElementById("dni").value;
      const matricula = document.getElementById("matricula").value;
      const provincia = document.getElementById("provincia").value;
      const localidad = document.getElementById("localidad").value;

      let mensaje = `Nuevo Pedido Bio-Fix\n`;
      mensaje += `Nombre: ${nombre} ${apellido}\nDNI: ${dni}\nMatr√≠cula: ${matricula}\nProvincia: ${provincia}, Localidad: ${localidad}\n--------------------\n`;

      for(let cat in datosSeleccionados){
        if(datosSeleccionados[cat].length>0){
          mensaje += `${cat}:\n`;
          datosSeleccionados[cat].forEach(item=>{
            mensaje += `- ${item.producto}${item.subtipo?' - '+item.subtipo:''}${item.medida?' : '+item.medida:''} x${item.cantidad}\n`;
          });
        }
      }

      const link = `https://wa.me/${vendedor.numero}?text=${encodeURIComponent(mensaje)}`;
      window.open(link, "_blank");
    }
    botonesDiv.appendChild(btn);
  });

  resumenDiv.appendChild(botonesDiv);

  document.getElementById("productos-section").style.display="none";
  document.getElementById("categorias-section").style.display="none";
  document.getElementById("resumen-section").style.display="block";
}
</script>

</body>
</html>
