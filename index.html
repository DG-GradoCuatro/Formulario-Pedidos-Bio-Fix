<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pedido Bio-Fix</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; }
    .container { max-width: 500px; margin: auto; padding: 20px; }
    h2 { text-align: center; color: #333; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, select, textarea, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
    button { background: #2e7d32; color: white; font-weight: bold; border: none; cursor: pointer; margin-top: 10px; }
    button:hover { background: #1b5e20; }
    .hidden { display: none; }
    /* medidas list styling */
    .measures-container { margin-top: 8px; }
    .measure-row { display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap; }
    .measure-label { flex:1; min-width: 120px; }
    .measure-qty { width: 90px; }
    .small-btn { padding:8px; font-size:14px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="container">

    <!-- PANTALLA 1: Datos -->
    <div id="pantalla1">
      <h2>Datos del Profesional</h2>
      <div class="form-group"><label>Nombre</label><input type="text" id="nombre" required></div>
      <div class="form-group"><label>Apellido</label><input type="text" id="apellido" required></div>
      <div class="form-group"><label>DNI</label><input type="number" id="dni" required></div>
      <div class="form-group">
        <label>Provincia</label>
        <select id="provincia" required>
          <option value="">Seleccione...</option>
          <option>Buenos Aires</option><option>Córdoba</option><option>Santa Fe</option><option>Mendoza</option>
          <option>Tucumán</option><option>Entre Ríos</option><option>Misiones</option><option>Chaco</option>
          <option>Salta</option><option>Jujuy</option><option>Neuquén</option><option>Río Negro</option>
          <option>Chubut</option><option>Santa Cruz</option><option>La Pampa</option><option>San Juan</option>
          <option>San Luis</option><option>Catamarca</option><option>La Rioja</option><option>Formosa</option>
          <option>Santiago del Estero</option><option>Tierra del Fuego</option>
        </select>
      </div>
      <div class="form-group"><label>Localidad</label><input type="text" id="localidad" required></div>
      <div class="form-group"><label>Matrícula</label><input type="text" id="matricula" required></div>
      <button onclick="irPantalla('pantalla2')">Siguiente</button>
    </div>

    <!-- PANTALLA 2: Categorías -->
    <div id="pantalla2" class="hidden">
      <h2>Seleccione categoría</h2>
      <button onclick="irPantalla('implantes')">Implantes</button>
      <button onclick="irPantalla('analogicos')">Comp. Protésicos Analógicos</button>
      <button onclick="irPantalla('digitales')">Comp. Protésicos Digitales</button>
      <button onclick="irPantalla('herramental')">Herramental</button>
      <button onclick="irPantalla('final')">Finalizar Pedido</button>
    </div>

    <!-- PANTALLA IMPLANTES -->
    <div id="implantes" class="hidden">
      <h2>Sistemas de Implantes</h2>
      <button class="small-btn" onclick="irPantalla('hi')">Hexágono Interno</button>
      <button class="small-btn" onclick="irPantalla('he')">Hexágono Externo</button>
      <button class="small-btn" onclick="irPantalla('cono')">Cono Morse</button>
      <button class="small-btn" onclick="irPantalla('mono')">Monopieza</button>
      <button class="small-btn" onclick="irPantalla('basal')">Monopieza Basal</button>
      <button class="small-btn" onclick="irPantalla('multiunit')">Compresivo Multiunit</button>
      <button class="small-btn" onclick="irPantalla('minipilar')">Minipilares</button>
      <button onclick="irPantalla('pantalla2')">⬅ Volver</button>
    </div>

    <!-- SISTEMA: Hexágono Interno -->
    <div id="hi" class="hidden">
      <h2>Implantes - Hexágono Interno</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="hi_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('hi_medidas','Implantes HI')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- Hexágono Externo -->
    <div id="he" class="hidden">
      <h2>Implantes - Hexágono Externo</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="he_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('he_medidas','Implantes HE')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- Cono Morse -->
    <div id="cono" class="hidden">
      <h2>Implantes - Cono Morse</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="cono_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('cono_medidas','Implantes Cono Morse')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- Monopieza -->
    <div id="mono" class="hidden">
      <h2>Implantes - Monopieza</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="mono_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('mono_medidas','Implantes Monopieza')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- Basal -->
    <div id="basal" class="hidden">
      <h2>Implantes - Basal</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="basal_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('basal_medidas','Implantes Basal')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- Multiunit -->
    <div id="multiunit" class="hidden">
      <h2>Implantes - Compresivo Multiunit</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="multi_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('multi_medidas','Implantes Multiunit')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- Minipilares -->
    <div id="minipilar" class="hidden">
      <h2>Implantes - Minipilares</h2>
      <label>Ingrese cantidad por medida (0 = no agregar)</label>
      <div id="minipilar_medidas" class="measures-container"></div>
      <button onclick="guardarMedidas('minipilar_medidas','Implantes Minipilares')">Agregar</button>
      <button onclick="irPantalla('implantes')">⬅ Volver</button>
    </div>

    <!-- COMPONENTES ANALÓGICOS -->
    <div id="analogicos" class="hidden">
      <h2>Componentes Analógicos</h2>
      <select multiple id="analogicos_lista">
        <!-- Cargar aquí todos los componentes si querés -->
      </select>
      <button onclick="guardarSeleccion('analogicos_lista','Componentes Analógicos')">Agregar</button>
      <button onclick="irPantalla('pantalla2')">⬅ Volver</button>
    </div>

    <!-- COMPONENTES DIGITALES -->
    <div id="digitales" class="hidden">
      <h2>Componentes Digitales</h2>
      <select multiple id="digitales_lista">
        <!-- Cargar aquí todos los componentes -->
      </select>
      <button onclick="guardarSeleccion('digitales_lista','Componentes Digitales')">Agregar</button>
      <button onclick="irPantalla('pantalla2')">⬅ Volver</button>
    </div>

    <!-- HERRAMENTAL -->
    <div id="herramental" class="hidden">
      <h2>Herramental</h2>
      <select multiple id="herramental_lista">
        <!-- Cargar herramientas -->
      </select>
      <button onclick="guardarSeleccion('herramental_lista','Herramental')">Agregar</button>
      <button onclick="irPantalla('pantalla2')">⬅ Volver</button>
    </div>

    <!-- PANTALLA FINAL -->
    <div id="final" class="hidden">
      <h2>Finalizar Pedido</h2>
      <div class="form-group">
        <label>Enviar a:</label>
        <select id="vendedor">
          <option value="5491122223333">Vendedor 1</option>
          <option value="5491133334444">Vendedor 2</option>
        </select>
      </div>
      <button onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
      <button onclick="irPantalla('pantalla2')">⬅ Volver</button>
    </div>

  </div>

  <script>
    // pedido global
    let pedido = [];

    // Medidas por sistema (completá o editá las listas como quieras)
    const medidasPorSistema = {
      "hi_medidas": ["Ø3.3 x 8.5 mm", "Ø3.3 x 10 mm", "Ø3.75 x 11.5 mm", "Ø4.0 x 13 mm", "Ø5.0 x 15 mm"],
      "he_medidas": ["Ø3.75 x 8.5 mm", "Ø4.0 x 10 mm", "Ø5.0 x 13 mm"],
      "cono_medidas": ["Ø3.5 x 11.5 mm", "Ø4.0 x 13 mm"],
      "mono_medidas": ["Ø3.0 x 10 mm", "Ø3.5 x 13 mm"],
      "basal_medidas": ["Ø3.5 x 10 mm", "Ø4.0 x 12 mm"],
      "multi_medidas": ["Ø3.75 x 10 mm", "Ø4.0 x 13 mm"],
      "minipilar_medidas": ["Corto", "Mediano", "Largo"]
    };

    // Pone las medidas en cada contenedor como fila con input de cantidad
    function renderMedidas() {
      for (const contId in medidasPorSistema) {
        const cont = document.getElementById(contId);
        if (!cont) continue;
        cont.innerHTML = ""; // limpiar
        medidasPorSistema[contId].forEach(medida => {
          const row = document.createElement("div");
          row.className = "measure-row";
          row.dataset.measure = medida;

          const label = document.createElement("div");
          label.className = "measure-label";
          label.textContent = medida;

          const qty = document.createElement("input");
          qty.type = "number";
          qty.min = "0";
          qty.value = "0";
          qty.className = "measure-qty";
          qty.setAttribute("aria-label", `Cantidad ${medida}`);

          row.appendChild(label);
          row.appendChild(qty);
          cont.appendChild(row);
        });
      }
    }

    // Guardar medidas con cantidad > 0 desde un contenedor de medidas
    function guardarMedidas(containerId, titulo) {
      const cont = document.getElementById(containerId);
      if (!cont) return;
      const rows = cont.querySelectorAll(".measure-row");
      let added = 0;
      rows.forEach(row => {
        const medida = row.dataset.measure;
        const qtyInput = row.querySelector("input");
        const qty = parseInt(qtyInput.value || 0, 10);
        if (qty && qty > 0) {
          pedido.push(`${titulo}: ${medida} x${qty}`);
          added++;
          qtyInput.value = "0"; // resetear
        }
      });
      if (added) {
        alert(`Agregados ${added} ítem(s) al pedido`);
      } else {
        alert("No se agregó nada: ingrese cantidad mayor a 0 en alguna medida");
      }
    }

    // Guardar desde selects (componentes/herramental) - versión anterior
    function guardarSeleccion(selectId, titulo) {
      const select = document.getElementById(selectId);
      if (!select) return;
      const seleccion = Array.from(select.selectedOptions).map(opt => opt.value).join(", ");
      if (seleccion) {
        pedido.push(`${titulo}: ${seleccion}`);
        // opcional: deseleccionar
        Array.from(select.options).forEach(o => o.selected = false);
        alert("Agregado al pedido");
      } else {
        alert("No hay elementos seleccionados");
      }
    }

    function irPantalla(id) {
      document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
      const el = document.getElementById(id);
      if (el) el.classList.remove('hidden');
    }

    function enviarWhatsApp() {
      const nombre = document.getElementById("nombre").value || '';
      const apellido = document.getElementById("apellido").value || '';
      const dni = document.getElementById("dni").value || '';
      const provincia = document.getElementById("provincia").value || '';
      const localidad = document.getElementById("localidad").value || '';
      const matricula = document.getElementById("matricula").value || '';
      const vendedor = document.getElementById("vendedor").value;

      if (!nombre || !apellido) {
        if(!confirm("Faltan nombre/apellido. Desea continuar?")) return;
      }

      let mensaje = `🦷 *Nuevo Pedido Bio-Fix* 🦷%0A` +
                    `👤 Nombre: ${nombre} ${apellido}%0A` +
                    `🪪 DNI: ${dni}%0A` +
                    `🌎 Provincia: ${provincia}, Localidad: ${localidad}%0A` +
                    `📄 Matrícula: ${matricula}%0A` +
                    `--------------------%0A`;

      if (pedido.length === 0) {
        if(!confirm("El pedido está vacío. Desea enviar igual?")) return;
      } else {
        mensaje += pedido.join("%0A");
      }

      const url = `https://wa.me/${vendedor}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, "_blank");
    }

    // Inicializar
    document.addEventListener("DOMContentLoaded", () => {
      renderMedidas();
    });
  </script>
</body>
</html>
