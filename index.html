<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pedido Bio-Fix</title>
<style>
  body { font-family: Arial, sans-serif; padding: 15px; background: #f4f4f4; }
  h2,h3{text-align:center;margin-bottom:10px;}
  .section{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;display:none;}
  .item{display:flex;flex-direction:column;gap:10px;margin-bottom:10px;}
  select,input{padding:10px;font-size:16px;width:100%;}
  button{background:#25d366;color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;margin-top:10px;font-size:16px;}
  button:hover{background:#1ebe5c;}
  .nota-seguridad{font-size:12px;color:#555;text-align:center;margin-top:10px;}
  #resumenPedido{white-space:pre-line; background:#eee; padding:10px; border-radius:8px;}
  .categorias-grid{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}
  .categorias-grid button{background:#007bff;}
  .categorias-grid button:hover{background:#0062cc;}
</style>
</head>
<body>

<h2>Formulario de Pedido Bio-Fix</h2>

<!-- SECCIÓN INICIAL -->
<div class="section" id="inicio-section" style="display:block;">
  <h3>¿Es tu primer pedido o eres cliente recurrente?</h3>
  <div style="display:flex;gap:15px;justify-content:center;margin-top:15px;">
    <button onclick="primerPedido()">Primer Pedido</button>
    <button onclick="clienteRecurrente()">Cliente Recurrente</button>
  </div>
</div>

<!-- SECCIÓN 1: DATOS ODONTÓLOGO -->
<div class="section" id="datos-section">
  <h3>Datos del odontólogo</h3>
  <input type="text" placeholder="Nombre" id="nombre">
  <input type="text" placeholder="Apellido" id="apellido">
  <input type="text" placeholder="DNI" id="dni">
  <input type="text" placeholder="Matrícula profesional" id="matricula">
  <select id="provincia">
    <option value="">Seleccionar provincia</option>
    <option>Buenos Aires</option>
    <option>Córdoba</option>
    <option>Santa Fe</option>
    <option>Mendoza</option>
    <option>Entre Ríos</option>
  </select>
  <input type="text" placeholder="Localidad" id="localidad">
  <button id="btnSiguienteDatos" style="display:none;">Siguiente</button>
</div>

<!-- SECCIÓN 2: CATEGORÍAS -->
<div class="section" id="categorias-section">
  <h3>Selecciona categoría</h3>
  <div class="categorias-grid" id="categorias-buttons"></div>
  <div style="text-align:center;margin-top:8px;">
    <button onclick="volverADatos()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<!-- SECCIÓN 3: PRODUCTOS -->
<div class="section" id="productos-section">
  <h3 id="tituloProductos">Productos</h3>
  <div id="productos-list"></div>
  <button onclick="agregarProducto()">+ Agregar Producto</button>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
    <button onclick="guardarProductos()">Guardar y volver a Categorías</button>
    <button onclick="mostrarResumen()">Ver Pedido</button>
    <button onclick="volverACategorias()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<!-- SECCIÓN 4: RESUMEN -->
<div class="section" id="resumen-section">
  <h3>Resumen del Pedido</h3>
  <div id="resumenPedido"></div>
  <div style="margin-top:10px;">
    <label>Selecciona vendedor habitual:</label>
    <select id="vendedorSeleccionado" style="width:100%;padding:10px;margin-top:5px;">
      <!-- Se llena dinámicamente -->
    </select>
  </div>
  <div id="vendedoresBtns" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;"></div>
  <div style="margin-top:10px;">
    <button onclick="volverAProductos()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<p class="nota-seguridad">🔒 Tu información se procesa de forma segura.</p>

<script>
// --- FLUJO INICIAL ---
function primerPedido(){
  document.getElementById("inicio-section").style.display = "none";
  document.getElementById("datos-section").style.display = "block";
}
function clienteRecurrente(){
  document.getElementById("inicio-section").style.display = "none";
  document.getElementById("categorias-section").style.display = "block";
}

// --- VALIDACIÓN DATOS ---
const campos = ["nombre","apellido","dni","matricula","provincia","localidad"];
const btnSiguienteDatos = document.getElementById("btnSiguienteDatos");

campos.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  if (el.tagName === "SELECT") el.addEventListener("change", validarDatos);
  else el.addEventListener("input", validarDatos);
});

function validarDatos(){
  const completos = campos.every(c=>{
    const el = document.getElementById(c);
    return el && el.value.trim() !== "";
  });
  btnSiguienteDatos.style.display = completos ? "block" : "none";
}

btnSiguienteDatos.addEventListener("click", ()=> {
  document.getElementById("datos-section").style.display="none";
  document.getElementById("categorias-section").style.display="block";
});

// --- VOLVER ---
function volverADatos(){ document.getElementById("categorias-section").style.display="none"; document.getElementById("datos-section").style.display="block"; }
function volverACategorias(){ document.getElementById("productos-section").style.display="none"; document.getElementById("categorias-section").style.display="block"; }
function volverAProductos(){ document.getElementById("resumen-section").style.display="none"; document.getElementById("productos-section").style.display="block"; }

// --- CATALOGO DE EJEMPLO (simplificado) ---
const catalogo = {
  "Implantes": {
    "Compresivo Multiunit": [
      "Ø3.0 x 6 mm","Ø3.0 x 8 mm","Ø3.0 x 10 mm","Ø3.0 x 11.5 mm","Ø3.0 x 13 mm",
      "Ø3.5 x 6 mm","Ø3.5 x 8 mm","Ø3.5 x 10 mm","Ø3.5 x 11.5 mm","Ø3.5 x 13 mm"
    ]
  },
  "Herramental": {
    "Fresa Lanza": ["Corta","Larga"]
  }
};
const sinMedida = ["Fresa Lanza"];
let datosSeleccionados = {};
Object.keys(catalogo).forEach(k => datosSeleccionados[k] = []);
let categoriaActual = "";

// Vendedores
const vendedores = [
  {nombre:"Vendedor 1", numero:"5491134019090"},
  {nombre:"Vendedor 2", numero:"5491164336112"}
];

// Crear botones de categorías
function crearBotonesCategorias(){
  const cont = document.getElementById("categorias-buttons");
  cont.innerHTML = "";
  Object.keys(catalogo).forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => mostrarProductos(cat);
    cont.appendChild(btn);
  });
}
crearBotonesCategorias();

// --- FUNCIONES PRODUCTOS ---
function mostrarProductos(categoria){
  categoriaActual = categoria;
  document.getElementById("categorias-section").style.display = "none";
  document.getElementById("productos-section").style.display = "block";
  document.getElementById("tituloProductos").innerText = categoria;
  cargarProductosGuardados();
}

function agregarProducto(){
  const lista = document.getElementById("productos-list");
  const div = document.createElement("div");
  div.classList.add("item");

  const selectProducto = document.createElement("select");
  selectProducto.innerHTML = "<option value=''>Seleccionar producto</option>";
  const opciones = catalogo[categoriaActual];
  for (let p in opciones) selectProducto.innerHTML += `<option value="${p}">${p}</option>`;
  div.appendChild(selectProducto);

  const inputCantidad = document.createElement("input");
  inputCantidad.placeholder = "Cantidad";
  inputCantidad.type = "number";
  inputCantidad.min = 1;
  div.appendChild(inputCantidad);

  lista.appendChild(div);
}

function guardarProductos(){
  const items = document.getElementById("productos-list").children;
  datosSeleccionados[categoriaActual] = [];
  Array.from(items).forEach(it=>{
    const prod = it.querySelector("select").value;
    const cant = it.querySelector("input").value;
    if(prod && cant) datosSeleccionados[categoriaActual].push({producto:prod,cantidad:cant});
  });
  document.getElementById("productos-list").innerHTML = "";
  document.getElementById("productos-section").style.display="none";
  document.getElementById("categorias-section").style.display="block";
}

// --- RESUMEN ---
function mostrarResumen(){
  document.getElementById("categorias-section").style.display="none";
  document.getElementById("productos-section").style.display="none";
  document.getElementById("resumen-section").style.display="block";

  let resumen = "";
  if(document.getElementById("datos-section").style.display==="block"){
    const nombre = document.getElementById("nombre").value;
    const apellido = document.getElementById("apellido").value;
    const dni = document.getElementById("dni").value;
    const matricula = document.getElementById("matricula").value;
    const provincia = document.getElementById("provincia").value;
    const localidad = document.getElementById("localidad").value;
    resumen += `Nuevo Pedido Bio-Fix\nNombre: ${nombre} ${apellido}\nDNI: ${dni}\nMatrícula: ${matricula}\nProvincia: ${provincia}\nLocalidad: ${localidad}\n----------------\n`;
  }

  for(let cat in datosSeleccionados){
    if(datosSeleccionados[cat].length>0){
      resumen += `\n${cat}:\n`;
      datosSeleccionados[cat].forEach(p=>{
        resumen += `- ${p.producto} x${p.cantidad}\n`;
      });
    }
  }

  document.getElementById("resumenPedido").innerText = resumen;

  // Vendedores
  const selVendedor = document.getElementById("vendedorSeleccionado");
  selVendedor.innerHTML = "";
  vendedores.forEach(v=>{
    const opt = document.createElement("option");
    opt.value = v.numero;
    opt.textContent = v.nombre;
    selVendedor.appendChild(opt);
  });
}

// --- CARGA PRODUCTOS GUARDADOS ---
function cargarProductosGuardados(){
  const lista = document.getElementById("productos-list");
  lista.innerHTML = "";
  datosSeleccionados[categoriaActual].forEach(p=>{
    const div = document.createElement("div");
    div.classList.add("item");

    const selectProducto = document.createElement("select");
    selectProducto.innerHTML = "<option value=''>Seleccionar producto</option>";
    const opciones = catalogo[categoriaActual];
    for (let prod in opciones) selectProducto.innerHTML += `<option value="${prod}">${prod}</option>`;
    selectProducto.value = p.producto;
    div.appendChild(selectProducto);

    const inputCantidad = document.createElement("input");
    inputCantidad.placeholder = "Cantidad";
    inputCantidad.type = "number";
    inputCantidad.min = 1;
    inputCantidad.value = p.cantidad;
    div.appendChild(inputCantidad);

    lista.appendChild(div);
  });
}
</script>

</body>
</html>

