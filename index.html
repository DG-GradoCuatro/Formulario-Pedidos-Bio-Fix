<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedido Bio-Fix</title>
<style>
body { font-family: Arial, sans-serif; padding: 15px; background: #f4f4f4; }
h2,h3{text-align:center;margin-bottom:10px;}
.section{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;display:none;}
.item{display:flex;flex-direction:column;gap:10px;margin-bottom:10px;}
select,input{padding:10px;font-size:16px;width:100%;}
button{background:#25d366;color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;margin-top:10px;font-size:16px;}
button:hover{background:#1ebe5c;}
.nota-seguridad{font-size:12px;color:#555;text-align:center;margin-top:10px;}
#resumenPedido{white-space:pre-line; background:#eee; padding:10px; border-radius:8px;}
.categorias-grid{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}
.categorias-grid button{background:#007bff;}
.categorias-grid button:hover{background:#0062cc;}
</style>
</head>
<body>

<h2>Formulario de Pedido Bio-Fix</h2>

<!-- SECCI칍N 1: DATOS ODONT칍LOGO -->
<div class="section" id="datos-section" style="display:block;">
  <h3>Datos del odont칩logo</h3>
  <input type="text" placeholder="Nombre" id="nombre">
  <input type="text" placeholder="Apellido" id="apellido">
  <input type="text" placeholder="DNI" id="dni">
  <input type="text" placeholder="Matr칤cula profesional" id="matricula">
  <select id="provincia">
    <option value="">Seleccionar provincia</option>
    <option>Buenos Aires</option>
    <option>C칩rdoba</option>
    <option>Santa Fe</option>
    <option>Mendoza</option>
    <option>Entre R칤os</option>
  </select>
  <input type="text" placeholder="Localidad" id="localidad">
  <button id="btnSiguienteDatos" style="display:none;">Siguiente</button>
</div>

<!-- SECCI칍N 2: CATEGOR칈AS -->
<div class="section" id="categorias-section">
  <h3>Selecciona categor칤a</h3>
  <div class="categorias-grid" id="categorias-buttons"></div>
  <div style="text-align:center;margin-top:8px;">
    <button onclick="volverADatos()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<!-- SECCI칍N 3: PRODUCTOS -->
<div class="section" id="productos-section">
  <h3 id="tituloProductos">Productos</h3>
  <div id="productos-list"></div>
  <button onclick="agregarProducto()">+ Agregar Producto</button>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
    <button onclick="guardarProductos()">Guardar y volver a Categor칤as</button>
    <button onclick="mostrarResumen()">Ver Pedido</button>
    <button onclick="volverACategorias()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<!-- SECCI칍N 4: RESUMEN -->
<div class="section" id="resumen-section">
  <h3>Resumen del Pedido</h3>
  <div id="resumenPedido"></div>
  <div id="vendedoresBtns" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;"></div>
  <div style="margin-top:10px;">
    <button onclick="volverAProductos()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<p class="nota-seguridad">游 Tu informaci칩n se procesa de forma segura.</p>

<script>
// --- VALIDACI칍N DATOS ---
const campos = ["nombre","apellido","dni","matricula","provincia","localidad"];
const btnSiguienteDatos = document.getElementById("btnSiguienteDatos");

campos.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  if (el.tagName === "SELECT") el.addEventListener("change", validarDatos);
  else el.addEventListener("input", validarDatos);
});

function validarDatos(){
  const completos = campos.every(c=>{
    const el = document.getElementById(c);
    return el && el.value.trim() !== "";
  });
  btnSiguienteDatos.style.display = completos ? "block" : "none";
}

btnSiguienteDatos.addEventListener("click", ()=> {
  document.getElementById("datos-section").style.display="none";
  document.getElementById("categorias-section").style.display="block";
});

// --- VOLVER ---
function volverADatos(){ document.getElementById("categorias-section").style.display="none"; document.getElementById("datos-section").style.display="block"; }
function volverACategorias(){ document.getElementById("productos-section").style.display="none"; document.getElementById("categorias-section").style.display="block"; }
function volverAProductos(){ document.getElementById("resumen-section").style.display="none"; document.getElementById("productos-section").style.display="block"; }

// --- CATALOGO (top-level: Implantes, Componentes Anal칩gicos, Herramental) ---
// He movido Cono Morse, Monopieza y Compresivo Multiunit dentro de "Componentes Anal칩gicos"
const catalogo = {
  "Implantes": {
    "Hex치gono Interno": [
      "칒3.0 x 6.5 mm","칒3.0 x 8 mm","칒3.0 x 10 mm","칒3.0 x 11.5 mm","칒3.0 x 13 mm","칒3.0 x 16 mm",
      "칒3.75 x 6.5 mm","칒3.75 x 8 mm","칒3.75 x 10 mm","칒3.75 x 11.5 mm","칒3.75 x 13 mm","칒3.75 x 16 mm",
      "칒4.2 x 6.5 mm","칒4.2 x 8 mm","칒4.2 x 10 mm","칒4.2 x 11.5 mm","칒4.2 x 13 mm","칒4.2 x 16 mm",
      "칒5.0 x 6.5 mm","칒5.0 x 8 mm","칒5.0 x 10 mm","칒5.0 x 11.5 mm","칒5.0 x 13 mm","칒5.0 x 16 mm"
    ],
    "Hex치gono Externo": {
      "칒3.30 (Plataforma 칒3.4)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "칒3.75 (Plataforma 칒4.1)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "칒4.0 (Plataforma 칒4.1)": ["6 mm","8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "칒5.0 (Plataforma 칒5.0)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"]
    },
    "Monopieza Basal": {
      "Pulido": [
        "칒3.5 x 10 mm","칒3.5 x 12 mm","칒3.5 x 15 mm","칒3.5 x 18 mm","칒3.5 x 21 mm","칒3.5 x 23 mm","칒3.5 x 24 mm","칒3.5 x 26 mm","칒3.5 x 28 mm",
        "칒4.5 x 10 mm","칒4.5 x 12 mm","칒4.5 x 15 mm","칒4.5 x 18 mm","칒4.5 x 21 mm","칒4.5 x 23 mm","칒4.5 x 24 mm","칒4.5 x 26 mm","칒4.5 x 28 mm",
        "칒5.5 x 10 mm","칒5.5 x 12 mm","칒5.5 x 15 mm","칒5.5 x 18 mm",
        "칒6.5 x 10 mm","칒6.5 x 12 mm","칒6.5 x 15 mm",
        "칒8.5 x 10 mm","칒8.5 x 12 mm","칒8.5 x 15 mm"
      ],
      "Tratamiento superficial": [
        "칒3.5 x 10 mm","칒3.5 x 12 mm","칒3.5 x 15 mm","칒3.5 x 18 mm","칒3.5 x 21 mm","칒3.5 x 23 mm","칒3.5 x 24 mm","칒3.5 x 26 mm","칒3.5 x 28 mm",
        "칒4.5 x 10 mm","칒4.5 x 12 mm","칒4.5 x 15 mm","칒4.5 x 18 mm","칒4.5 x 21 mm","칒4.5 x 23 mm","칒4.5 x 24 mm","칒4.5 x 26 mm","칒4.5 x 28 mm",
        "칒5.5 x 10 mm","칒5.5 x 12 mm","칒5.5 x 15 mm","칒5.5 x 18 mm",
        "칒6.5 x 10 mm","칒6.5 x 12 mm","칒6.5 x 15 mm",
        "칒8.5 x 10 mm","칒8.5 x 12 mm","칒8.5 x 15 mm"
      ]
    }
  },

  "Componentes Anal칩gicos": {
    "Hex치gono Interno": {
      "Ucla Calcinable": ["Rotacional","Anti-Rotacional"],
      "An치logo de Titanio": [],
      "BallAttach y Cazoleta": ["H1","H2","H3","H4"],
      "Tapa de cicatrizaci칩n": ["H1","H2","H3","H4"],
      "Transfer cubeta": ["Abierta","Cerrada"],
      "Pilar recto c/tornillo": ["H1","H2","H3","H4"],
      "Minipilar Angulado H.I + Llave transportadora + tornillo": ["1.5mm","2.5mm","3.5mm"],
      "Pilar angulado c/tornillo": ["15춿","25춿"]
    },
    "Hex치gono Externo": {
      "Ucla calcinable": {
        "Rotacional": {
          "Plat 칒3.4": ["H1","H2","H3","H4"],
          "Plat 칒4.1": ["H1","H2","H3","H4"],
          "Plat 칒5.0": ["H1","H2","H3","H4"]
        },
        "Anti-rotacional": {
          "Plat 칒3.4": ["H1","H2","H3","H4"],
          "Plat 칒4.1": ["H1","H2","H3","H4"],
          "Plat 칒5.0": ["H1","H2","H3","H4"]
        }
      },
      "Tapa de cicatrizaci칩n": {
        "Plat 칒3.4": ["H1","H2","H3"],
        "Plat 칒4.1": ["H1","H2","H3"],
        "Plat 칒5.0": ["H1","H2","H3"]
      },
      "Transfer cubeta": {
        "Plat 칒3.4": ["Abierta","Cerrada"],
        "Plat 칒4.1": ["Abierta","Cerrada"],
        "Plat 칒5.0": ["Abierta","Cerrada"]
      },
      "Ball attach": {
        "Plat 칒3.4": ["H1","H2","H3","H4"],
        "Plat 칒4.1": ["H1","H2","H3","H4"],
        "Plat 칒5.0": ["H1","H2","H3","H4"]
      },
      "Pilar recto c/tornillo": {
        "Plat 칒3.4": { "H1-H3": ["Hexagonal","Cuadrado"] },
        "Plat 칒4.1": { "H1-H3": ["Hexagonal","Cuadrado"] },
        "Plat 칒5.0": { "H1-H3": ["Hexagonal","Cuadrado"] }
      },
      "Tornillo prot칠sico": ["Cuadrado","Hexagonal"],
      "Pilar angulado c/tornillo": {
        "Plat 칒4.1": ["15춿","25춿"]
      }
    },

    // === MOVIDOS AQU칈: Cono Morse, Monopieza y Compresivo Multiunit ===
    "Cono Morse": {
      "Pilares est치ndar": {
        "칒3.3": [
          "칒3.3x0.8x4","칒3.3x1.5x4","칒3.3x2.5x4","칒3.3x3.5x4","칒3.3x4.5x4","칒3.3x5.5x4",
          "칒3.3x0.8x6","칒3.3x1.5x6","칒3.3x2.5x6","칒3.3x3.5x6","칒3.3x4.5x6","칒3.3x5.5x6"
        ],
        "칒4.5": [
          "칒4.5x0.8x4","칒4.5x1.5x4","칒4.5x2.5x4","칒4.5x3.5x4","칒4.5x4.5x4","칒4.5x5.5x4",
          "칒4.5x0.8x6","칒4.5x1.5x6","칒4.5x2.5x6","칒4.5x3.5x6","칒4.5x4.5x6","칒4.5x5.5x6"
        ]
      },
      "Pilares c/tornillo pasante": {
        "칒3.3": [
          "칒3.3x0.8x4","칒3.3x1.5x4","칒3.3x2.5x4","칒3.3x3.5x4","칒3.3x4.5x4","칒3.3x5.5x4",
          "칒3.3x0.8x6","칒3.3x1.5x6","칒3.3x2.5x6","칒3.3x3.5x6","칒3.3x4.5x6","칒3.3x5.5x6"
        ],
        "칒4.5": [
          "칒4.5x0.8x4","칒4.5x1.5x4","칒4.5x2.5x4","칒4.5x3.5x4","칒4.5x4.5x4","칒4.5x5.5x4",
          "칒4.5x0.8x6","칒4.5x1.5x6","칒4.5x2.5x6","칒4.5x3.5x6","칒4.5x4.5x6","칒4.5x5.5x6"
        ]
      },
      "Pilares de cicatrizaci칩n": {
        "칒3.3": ["H1.5","H2.5","H3.5"],
        "칒4.5": ["H1.5","H2.5","H3.5"]
      },
      "An치logo Universal": [],
      "BallAttach y Cazoleta": ["H1.5","H2.5","H3.5","H4.5","H5.5"]
    },

    "Monopieza": {
      "An치logo": [],
      "Ucla Calcinable": ["칒3.0","칒3.5","칒4.0","칒4.5","칒5.0"],
      "Transfer Rotacional": []
    },

    "Compresivo Multiunit": {
      "Transfer Cubeta Abierta": [],
      "Cicatrizal c/tornillo": ["H2","H3","H4"],
      "Ballattach y cazoleta": ["H2","H3","H4"],
      "Pilar Recto c/tornillo": []
    }

  },

  "Herramental": {
    "Fresa Lanza": ["Corta","Larga"],
    "Fresa Lanza Guiada": ["Corta","Larga"],
    "Fresa Helicoidal": ["칒2.0","칒2.5","칒2.8","칒3.2","칒3.6","칒4.0","칒4.3","칒4.6","칒5.0","칒5.3"],
    "Kit 3 Expansores de Hueso": [],
    "Kit 3 Expansores de Hueso - Monopieza": [],
    "Torquimetro Dinamometrico": [],
    "Mango Rigido": [],
    "Mango para angulacion de Pilar MP": [],
    "Extractor de Raiz residual": [],
    "Driver Retractil": [],
    "Punta Driver para Monopieza": ["Larga","Corta"],
    "Llave conectora para contrangulo MP": ["Larga","Corta"],
    "Destornillador Digital Cuadrado": ["Corto 0.050","Est치ndar 0.050","Largo 0.050","Extra Largo 0.050"],
    "Destornillador Digital Hexagonal": ["Corto 0.048","Estandar 0.048","Largo 0.048","Extra Largo 0.048"],
    "Destornillador Cuadrado p/Torqu칤metro": ["Corto 0.050","Est치ndar 0.050","Largo 0.050","Extra Largo 0.050"],
    "Destornillador Hexagonal p/Torqu칤metro": ["Corto 0.048","Estandar 0.048","Largo 0.048","Extra Largo 0.048"],
    "Prolongador de Fresa": [],
    "Prolongador 4x4": ["Corto","Largo"],
    "Conctor para torqu칤metro CMHI": [],
    "Punch": ["3.4mm","4.1mm","5.0mm"],
    "Anilla para Guia": ["칒5,5-칒2,1","칒5,5-칒4,2","칒4,1-칒3,0"],
    "Llave conectora Monopieza": ["Corta","Larga"],
    "Llave conectora CMU": ["Corta","Larga"]
  }
};

// --- Productos sin medida (solo opciones fijas) ---
const sinMedida = ["Fresa Lanza","Fresa Lanza Guiada"];

// --- GUARDAR DATOS SELECCIONADOS ---
let datosSeleccionados = {};
Object.keys(catalogo).forEach(k => datosSeleccionados[k] = []);
let categoriaActual = "";

// Vendedores (para botones de env칤o)
const vendedores = [
  {nombre:"Vendedor 1", numero:"5491134019090"},
  {nombre:"Vendedor 2", numero:"5491164336112"}
];

// --- GENERAR BOTONES DE CATEGOR칈AS (solo las 3 que quer칠s) ---
function crearBotonesCategorias(){
  const cont = document.getElementById("categorias-buttons");
  cont.innerHTML = "";
  Object.keys(catalogo).forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => mostrarProductos(cat);
    cont.appendChild(btn);
  });
}
crearBotonesCategorias();

// --- FUNCIONES DE PRODUCTOS ---
function mostrarProductos(categoria){
  categoriaActual = categoria;
  document.getElementById("categorias-section").style.display = "none";
  document.getElementById("productos-section").style.display = "block";
  document.getElementById("tituloProductos").innerText = categoria;
  cargarProductosGuardados();
}

function agregarProducto(){
  const lista = document.getElementById("productos-list");
  const div = document.createElement("div");
  div.classList.add("item");

  const selectProducto = document.createElement("select");
  selectProducto.innerHTML = "<option value=''>Seleccionar producto</option>";
  const opciones = catalogo[categoriaActual];
  for (let p in opciones){
    selectProducto.innerHTML += `<option value="${p}">${p}</option>`;
  }

  const selectSubtipo = document.createElement("select");
  selectSubtipo.style.display = "none";

  const selectMedida = document.createElement("select");
  selectMedida.style.display = "none";

  const inputCantidad = document.createElement("input");
  inputCantidad.type = "number";
  inputCantidad.min = "1";
  inputCantidad.placeholder = "Cantidad";
  inputCantidad.style.display = "none";

  selectProducto.addEventListener("change", ()=>{ manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });
  selectSubtipo.addEventListener("change", ()=>{ manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });

  div.appendChild(selectProducto);
  div.appendChild(selectSubtipo);
  div.appendChild(selectMedida);
  div.appendChild(inputCantidad);
  lista.appendChild(div);
}

function manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad){
  const clave = selectProducto.value;
  const p = catalogo[categoriaActual][clave];

  selectSubtipo.style.display = "none";
  selectMedida.style.display = "none";
  inputCantidad.style.display = "none";
  selectSubtipo.innerHTML = "";
  selectMedida.innerHTML = "";

  if(!p) return;

  if (sinMedida.includes(clave) && Array.isArray(p)){
    selectSubtipo.style.display = "block";
    selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
    p.forEach(o => selectSubtipo.innerHTML += `<option value="${o}">${o}</option>`);
    inputCantidad.style.display = "block";
    return;
  }

  if (Array.isArray(p)){
    selectMedida.style.display = "block";
    selectMedida.innerHTML = "<option value=''>Seleccionar</option>";
    p.forEach(m => selectMedida.innerHTML += `<option value="${m}">${m}</option>`);
    inputCantidad.style.display = "block";
  } else if (typeof p === "object"){
    selectSubtipo.style.display = "block";
    selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
    for (let s in p) selectSubtipo.innerHTML += `<option value="${s}">${s}</option>`;
  }
}

function manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad){
  const p = catalogo[categoriaActual][selectProducto.value];
  const medidas = p ? p[selectSubtipo.value] : null;
  selectMedida.innerHTML = "<option value=''>Seleccionar</option>";
  if (medidas && medidas.length > 0){
    selectMedida.style.display = "block";
    medidas.forEach(m => selectMedida.innerHTML += `<option value="${m}">${m}</option>`);
  } else {
    selectMedida.style.display = "none";
  }
  inputCantidad.style.display = "block";
}

function guardarProductos(){
  const lista = document.querySelectorAll("#productos-list .item");
  datosSeleccionados[categoriaActual] = [];
  lista.forEach(item=>{
    const producto = item.querySelector("select:nth-child(1)").value;
    const subtipo = item.querySelector("select:nth-child(2)") ? item.querySelector("select:nth-child(2)").value : "";
    const medida = item.querySelector("select:nth-child(3)") ? item.querySelector("select:nth-child(3)").value : "";
    const cantidadInput = item.querySelector("input");
    const cantidad = cantidadInput ? cantidadInput.value : "";
    if(producto && cantidad){
      datosSeleccionados[categoriaActual].push({producto,subtipo,medida,cantidad});
    }
  });
  document.getElementById("productos-list").innerHTML = "";
  document.getElementById("productos-section").style.display = "none";
  document.getElementById("categorias-section").style.display = "block";
}

function cargarProductosGuardados(){
  const lista = document.getElementById("productos-list");
  lista.innerHTML = "";
  datosSeleccionados[categoriaActual].forEach(item=>{
    const div = document.createElement("div");
    div.classList.add("item");
    div.innerHTML = `<div>${item.producto}${item.subtipo?` - ${item.subtipo}`:""}${item.medida?` : ${item.medida}`:""} x${item.cantidad}</div>`;
    lista.appendChild(div);
  });
}

// --- RESUMEN y env칤o WhatsApp ---
let ultimoResumenTexto = "";

function mostrarResumen(){
  guardarProductos();

  const resumenDiv = document.getElementById("resumenPedido");
  resumenDiv.innerHTML = "";

  let textoResumen = "";
  const nombre = document.getElementById("nombre").value || "";
  const apellido = document.getElementById("apellido").value || "";
  const dni = document.getElementById("dni").value || "";
  const matricula = document.getElementById("matricula").value || "";
  const provincia = document.getElementById("provincia").value || "";
  const localidad = document.getElementById("localidad").value || "";

  textoResumen += `Nuevo Pedido Bio-Fix\n`;
  textoResumen += `Nombre: ${nombre} ${apellido}\nDNI: ${dni}\nMatr칤cula: ${matricula}\nProvincia: ${provincia}, Localidad: ${localidad}\n--------------------\n`;

  for (let cat of Object.keys(datosSeleccionados)){
    if (datosSeleccionados[cat] && datosSeleccionados[cat].length > 0){
      textoResumen += `${cat}:\n`;
      datosSeleccionados[cat].forEach(item=>{
        textoResumen += `* ${item.producto}${item.subtipo ? ' - '+item.subtipo : ''}${item.medida ? ' : '+item.medida : ''} x${item.cantidad}\n`;
      });
    }
  }

  resumenDiv.innerText = textoResumen;
  ultimoResumenTexto = textoResumen;

  const contVendedores = document.getElementById("vendedoresBtns");
  contVendedores.innerHTML = "";
  vendedores.forEach(vendedor => {
    const btn = document.createElement("button");
    btn.textContent = `Enviar a ${vendedor.nombre}`;
    btn.onclick = () => {
      const link = `https://wa.me/${vendedor.numero}?text=${encodeURIComponent(ultimoResumenTexto)}`;
      window.open(link, "_blank");
    };
    contVendedores.appendChild(btn);
  });

  document.getElementById("productos-section").style.display="none";
  document.getElementById("categorias-section").style.display="none";
  document.getElementById("resumen-section").style.display="block";
}

function enviarPedido(){
  if (!ultimoResumenTexto) mostrarResumen();
  const vendedor = vendedores[0];
  const link = `https://wa.me/${vendedor.numero}?text=${encodeURIComponent(ultimoResumenTexto)}`;
  window.open(link, "_blank");
}
</script>

</body>
</html>
