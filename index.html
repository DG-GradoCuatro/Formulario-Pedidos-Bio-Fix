<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedido Bio-Fix</title>
<style>
body { font-family: Arial, sans-serif; padding: 15px; background: #f4f4f4; }
h2,h3{text-align:center;margin-bottom:10px;}
.section{background:#fff;padding:15px;border-radius:10px;margin-bottom:20px;display:none;}
.item{display:flex;flex-direction:column;gap:10px;margin-bottom:10px;}
select,input{padding:10px;font-size:16px;width:100%;}
button{background:#25d366;color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;margin-top:10px;font-size:16px;}
button:hover{background:#1ebe5c;}
.nota-seguridad{font-size:12px;color:#555;text-align:center;margin-top:10px;}
#resumenPedido{white-space:pre-line; background:#eee; padding:10px; border-radius:8px;}
.categorias-grid{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;}
.categorias-grid button{background:#007bff;}
.categorias-grid button:hover{background:#0062cc;}
</style>
</head>
<body>

<h2>Formulario de Pedido Bio-Fix</h2>

<!-- SECCI√ìN 1: DATOS ODONT√ìLOGO -->
<div class="section" id="datos-section" style="display:block;">
  <h3>Datos del odont√≥logo</h3>
  <input type="text" placeholder="Nombre" id="nombre">
  <input type="text" placeholder="Apellido" id="apellido">
  <input type="text" placeholder="DNI" id="dni">
  <input type="text" placeholder="Matr√≠cula profesional" id="matricula">
  <select id="provincia">
    <option value="">Seleccionar provincia</option>
    <option>Buenos Aires</option>
    <option>C√≥rdoba</option>
    <option>Santa Fe</option>
    <option>Mendoza</option>
    <option>Entre R√≠os</option>
  </select>
  <input type="text" placeholder="Localidad" id="localidad">
  <button id="btnSiguienteDatos" style="display:none;">Siguiente</button>
</div>

<!-- SECCI√ìN 2: CATEGOR√çAS -->
<div class="section" id="categorias-section">
  <h3>Selecciona categor√≠a</h3>
  <div class="categorias-grid" id="categorias-buttons"></div>
  <div style="text-align:center;margin-top:8px;">
    <button onclick="volverADatos()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<!-- SECCI√ìN 3: PRODUCTOS -->
<div class="section" id="productos-section">
  <h3 id="tituloProductos">Productos</h3>
  <div id="productos-list"></div>
  <button onclick="agregarProducto()">+ Agregar Producto</button>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
    <button onclick="guardarProductos()">Guardar y volver a Categor√≠as</button>
    <button onclick="mostrarResumen()">Ver Pedido</button>
    <button onclick="volverACategorias()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<!-- SECCI√ìN 4: RESUMEN -->
<div class="section" id="resumen-section">
  <h3>Resumen del Pedido</h3>
  <div id="resumenPedido"></div>
  <div id="vendedoresBtns" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;"></div>
  <div style="margin-top:10px;">
    <button onclick="volverAProductos()" style="background:#6c757d;">Volver</button>
  </div>
</div>

<p class="nota-seguridad">üîí Tu informaci√≥n se procesa de forma segura.</p>

<script>
// --- VALIDACI√ìN DATOS ---
const campos = ["nombre","apellido","dni","matricula","provincia","localidad"];
const btnSiguienteDatos = document.getElementById("btnSiguienteDatos");

campos.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  if (el.tagName === "SELECT") el.addEventListener("change", validarDatos);
  else el.addEventListener("input", validarDatos);
});

function validarDatos(){
  const completos = campos.every(c=>{
    const el = document.getElementById(c);
    return el && el.value.trim() !== "";
  });
  btnSiguienteDatos.style.display = completos ? "block" : "none";
}

btnSiguienteDatos.addEventListener("click", ()=> {
  document.getElementById("datos-section").style.display="none";
  document.getElementById("categorias-section").style.display="block";
});

// --- VOLVER ---
function volverADatos(){ document.getElementById("categorias-section").style.display="none"; document.getElementById("datos-section").style.display="block"; }
function volverACategorias(){ document.getElementById("productos-section").style.display="none"; document.getElementById("categorias-section").style.display="block"; }
function volverAProductos(){ document.getElementById("resumen-section").style.display="none"; document.getElementById("productos-section").style.display="block"; }

// --- CATALOGO (orden y contenido respetados tal como lo enviaste) ---
const catalogo = {
  "Implantes": {
    "Hex√°gono Interno": [
      "√ò3.0 x 6.5 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 16 mm",
      "√ò3.75 x 6.5 mm","√ò3.75 x 8 mm","√ò3.75 x 10 mm","√ò3.75 x 11.5 mm","√ò3.75 x 13 mm","√ò3.75 x 16 mm",
      "√ò4.2 x 6.5 mm","√ò4.2 x 8 mm","√ò4.2 x 10 mm","√ò4.2 x 11.5 mm","√ò4.2 x 13 mm","√ò4.2 x 16 mm",
      "√ò5.0 x 6.5 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm","√ò5.0 x 16 mm"
    ],
    "Hex√°gono Externo": {
      "√ò3.30 (Plataforma √ò3.4)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "√ò3.75 (Plataforma √ò4.1)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "√ò4.0 (Plataforma √ò4.1)": ["6 mm","8.5 mm","10 mm","11.5 mm","13 mm","15 mm"],
      "√ò5.0 (Plataforma √ò5.0)": ["8.5 mm","10 mm","11.5 mm","13 mm","15 mm"]
    },
    "Cono Morse": [
      "√ò3.30 x 8 mm","√ò3.30 x 10 mm","√ò3.0 x 11.5 mm","√ò3.30 x 13 mm","√ò3.30 x 16 mm",
      "√ò3.75 x 8 mm","√ò3.75 x 10 mm","√ò3.75 x 11.5 mm","√ò3.75 x 13 mm","√ò3.75 x 16 mm",
      "√ò4.2 x 8 mm","√ò4.2 x 10 mm","√ò4.2 x 11.5 mm","√ò4.2 x 13 mm","√ò4.2 x 16 mm",
      "√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm","√ò5.0 x 16 mm"
    ],
    "Monopieza": [
      "√ò3.0 x 6 mm","√ò3.0 x 8 mm","√ò3.0 x 10 mm","√ò3.0 x 11.5 mm","√ò3.0 x 13 mm","√ò3.0 x 15 mm","√ò3.0 x 18 mm","√ò3.0 x 20 mm",
      "√ò3.5 x 6 mm","√ò3.5 x 8 mm","√ò3.5 x 10 mm","√ò3.5 x 11.5 mm","√ò3.5 x 13 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 20 mm",
      "√ò4.0 x 6 mm","√ò4.0 x 8 mm","√ò4.0 x 10 mm","√ò4.0 x 11.5 mm","√ò4.0 x 13 mm","√ò4.0 x 15 mm","√ò4.0 x 18 mm","√ò4.0 x 20 mm",
      "√ò4.5 x 6 mm","√ò4.5 x 8 mm","√ò4.5 x 10 mm","√ò4.5 x 11.5 mm","√ò4.5 x 13 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 20 mm",
      "√ò5.0 x 6 mm","√ò5.0 x 8 mm","√ò5.0 x 10 mm","√ò5.0 x 11.5 mm","√ò5.0 x 13 mm",
      "√ò5.5 x 6 mm","√ò5.5 x 8 mm","√ò5.5 x 10 mm","√ò5.5 x 11.5 mm","√ò5.5 x 13 mm"
    ],
    "Monopieza Basal": {
      "Pulido": [
        "√ò3.5 x 10 mm","√ò3.5 x 12 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 21 mm","√ò3.5 x 23 mm","√ò3.5 x 24 mm","√ò3.5 x 26 mm","√ò3.5 x 28 mm",
        "√ò4.5 x 10 mm","√ò4.5 x 12 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 21 mm","√ò4.5 x 23 mm","√ò4.5 x 24 mm","√ò4.5 x 26 mm","√ò4.5 x 28 mm",
        "√ò5.5 x 10 mm","√ò5.5 x 12 mm","√ò5.5 x 15 mm","√ò5.5 x 18 mm",
        "√ò6.5 x 10 mm","√ò6.5 x 12 mm","√ò6.5 x 15 mm",
        "√ò8.5 x 10 mm","√ò8.5 x 12 mm","√ò8.5 x 15 mm"
      ],
      "Tratamiento superficial": [
        "√ò3.5 x 10 mm","√ò3.5 x 12 mm","√ò3.5 x 15 mm","√ò3.5 x 18 mm","√ò3.5 x 21 mm","√ò3.5 x 23 mm","√ò3.5 x 24 mm","√ò3.5 x 26 mm","√ò3.5 x 28 mm",
        "√ò4.5 x 10 mm","√ò4.5 x 12 mm","√ò4.5 x 15 mm","√ò4.5 x 18 mm","√ò4.5 x 21 mm","√ò4.5 x 23 mm","√ò4.5 x 24 mm","√ò4.5 x 26 mm","√ò4.5 x 28 mm",
        "√ò5.5 x 10 mm","√ò5.5 x 12 mm","√ò5.5 x 15 mm","√ò5.5 x 18 mm",
        "√ò6.5 x 10 mm","√ò6.5 x 12 mm","√ò6.5 x 15 mm",
        "√ò8.5 x 10 mm","√ò8.5 x 12 mm","√ò8.5 x 15 mm"
      ]
    },
    "Compresivo Multiunit": ["√ò3.75 x 10 mm","√ò4.0 x 13 mm"]
  },

  "Componentes Anal√≥gicos": {
    "Hex√°gono Interno": {
      "Ucla Calcinable": ["Rotacional","Anti-Rotacional"],
      "An√°logo de Titanio": [],
      "BallAttach y Cazoleta": ["H1","H2","H3","H4"],
      "Tapa de cicatrizaci√≥n": ["H1","H2","H3","H4"],
      "Transfer cubeta": ["Abierta","Cerrada"],
      "Pilar recto c/tornillo": ["H1","H2","H3","H4"],
      "Minipilar Angulado H.I + Llave transportadora + tornillo": ["1.5mm","2.5mm","3.5mm"],
      "Pilar angulado c/tornillo": ["15¬∞","25¬∞"]
    },

    "Hex√°gono Externo": {
      "Ucla calcinable": {
        "Rotacional": {
          "Plat √ò3.4": ["H1","H2","H3","H4"],
          "Plat √ò4.1": ["H1","H2","H3","H4"],
          "Plat √ò5.0": ["H1","H2","H3","H4"]
        },
        "Anti-rotacional": {
          "Plat √ò3.4": ["H1","H2","H3","H4"],
          "Plat √ò4.1": ["H1","H2","H3","H4"],
          "Plat √ò5.0": ["H1","H2","H3","H4"]
        }
      },
      "Tapa de cicatrizaci√≥n": {
        "Plat √ò3.4": ["H1","H2","H3"],
        "Plat √ò4.1": ["H1","H2","H3"],
        "Plat √ò5.0": ["H1","H2","H3"]
      },
      "Transfer cubeta": {
        "Plat √ò3.4": ["Abierta","Cerrada"],
        "Plat √ò4.1": ["Abierta","Cerrada"],
        "Plat √ò5.0": ["Abierta","Cerrada"]
      },
      "Ball attach": {
        "Plat √ò3.4": ["H1","H2","H3","H4"],
        "Plat √ò4.1": ["H1","H2","H3","H4"],
        "Plat √ò5.0": ["H1","H2","H3","H4"]
      },
      "Pilar recto c/tornillo": {
        "Plat √ò3.4": { "H1-H3": ["Hexagonal","Cuadrado"] },
        "Plat √ò4.1": { "H1-H3": ["Hexagonal","Cuadrado"] },
        "Plat √ò5.0": { "H1-H3": ["Hexagonal","Cuadrado"] }
      },
      "Tornillo prot√©sico": ["Cuadrado","Hexagonal"],
      "Pilar angulado c/tornillo": {
        "Plat √ò4.1": ["15¬∞","25¬∞"]
      }
    }
  },

  "Cono Morse": {
    "Pilares est√°ndar": {
      "√ò3.3": [
        "√ò3.3x0.8x4","√ò3.3x1.5x4","√ò3.3x2.5x4","√ò3.3x3.5x4","√ò3.3x4.5x4","√ò3.3x5.5x4",
        "√ò3.3x0.8x6","√ò3.3x1.5x6","√ò3.3x2.5x6","√ò3.3x3.5x6","√ò3.3x4.5x6","√ò3.3x5.5x6"
      ],
      "√ò4.5": [
        "√ò4.5x0.8x4","√ò4.5x1.5x4","√ò4.5x2.5x4","√ò4.5x3.5x4","√ò4.5x4.5x4","√ò4.5x5.5x4",
        "√ò4.5x0.8x6","√ò4.5x1.5x6","√ò4.5x2.5x6","√ò4.5x3.5x6","√ò4.5x4.5x6","√ò4.5x5.5x6"
      ]
    },
    "Pilares c/tornillo pasante": {
      "√ò3.3": [
        "√ò3.3x0.8x4","√ò3.3x1.5x4","√ò3.3x2.5x4","√ò3.3x3.5x4","√ò3.3x4.5x4","√ò3.3x5.5x4",
        "√ò3.3x0.8x6","√ò3.3x1.5x6","√ò3.3x2.5x6","√ò3.3x3.5x6","√ò3.3x4.5x6","√ò3.3x5.5x6"
      ],
      "√ò4.5": [
        "√ò4.5x0.8x4","√ò4.5x1.5x4","√ò4.5x2.5x4","√ò4.5x3.5x4","√ò4.5x4.5x4","√ò4.5x5.5x4",
        "√ò4.5x0.8x6","√ò4.5x1.5x6","√ò4.5x2.5x6","√ò4.5x3.5x6","√ò4.5x4.5x6","√ò4.5x5.5x6"
      ]
    },
    "Pilares de cicatrizaci√≥n": {
      "√ò3.3": ["H1.5","H2.5","H3.5"],
      "√ò4.5": ["H1.5","H2.5","H3.5"]
    },
    "An√°logo Universal": [],
    "BallAttach y Cazoleta": ["H1.5","H2.5","H3.5","H4.5","H5.5"]
  },

  "Monopieza": {
    "An√°logo": [],
    "Ucla Calcinable": ["√ò3.0","√ò3.5","√ò4.0","√ò4.5","√ò5.0"],
    "Transfer Rotacional": []
  },

  "Compresivo Multiunit": {
    "Transfer Cubeta Abierta": [],
    "Cicatrizal c/tornillo": ["H2","H3","H4"],
    "Ballattach y cazoleta": ["H2","H3","H4"],
    "Pilar Recto c/tornillo": []
  },

  "Herramental": {
    "Fresa Lanza": ["Corta","Larga"],
    "Fresa Lanza Guiada": ["Corta","Larga"],
    "Fresa Helicoidal": ["√ò2.0","√ò2.5","√ò2.8","√ò3.2","√ò3.6","√ò4.0","√ò4.3","√ò4.6","√ò5.0","√ò5.3"],
    "Kit 3 Expansores de Hueso": [],
    "Kit 3 Expansores de Hueso - Monopieza": [],
    "Torquimetro Dinamometrico": [],
    "Mango Rigido": [],
    "Mango para angulacion de Pilar MP": [],
    "Extractor de Raiz residual": [],
    "Driver Retractil": [],
    "Punta Driver para Monopieza": ["Larga","Corta"],
    "Llave conectora para contrangulo MP": ["Larga","Corta"],
    "Destornillador Digital Cuadrado": ["Corto 0.050","Est√°ndar 0.050","Largo 0.050","Extra Largo 0.050"],
    "Destornillador Digital Hexagonal": ["Corto 0.048","Estandar 0.048","Largo 0.048","Extra Largo 0.048"],
    "Destornillador Cuadrado p/Torqu√≠metro": ["Corto 0.050","Est√°ndar 0.050","Largo 0.050","Extra Largo 0.050"],
    "Destornillador Hexagonal p/Torqu√≠metro": ["Corto 0.048","Estandar 0.048","Largo 0.048","Extra Largo 0.048"],
    "Prolongador de Fresa": [],
    "Prolongador 4x4": ["Corto","Largo"],
    "Conctor para torqu√≠metro CMHI": [],
    "Punch": ["3.4mm","4.1mm","5.0mm"],
    "Anilla para Guia": ["√ò5,5-√ò2,1","√ò5,5-√ò4,2","√ò4,1-√ò3,0"],
    "Llave conectora Monopieza": ["Corta","Larga"],
    "Llave conectora CMU": ["Corta","Larga"]
  }
};

// --- Productos sin medida (solo opciones fijas) ---
const sinMedida = ["Fresa Lanza","Fresa Lanza Guiada"];

// --- GUARDAR DATOS SELECCIONADOS ---
let datosSeleccionados = {};
// Inicializar arrays vac√≠os para cada categor√≠a del cat√°logo (preserva orden)
Object.keys(catalogo).forEach(k => datosSeleccionados[k] = []);
let categoriaActual = "";

// Vendedores (para botones de env√≠o)
const vendedores = [
  {nombre:"Vendedor 1", numero:"5491134019090"},
  {nombre:"Vendedor 2", numero:"5491164336112"}
];

// --- GENERAR BOTONES DE CATEGOR√çAS (respeta orden del objeto catalogo) ---
function crearBotonesCategorias(){
  const cont = document.getElementById("categorias-buttons");
  cont.innerHTML = "";
  Object.keys(catalogo).forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => mostrarProductos(cat);
    cont.appendChild(btn);
  });
}
crearBotonesCategorias();

// --- FUNCIONES DE PRODUCTOS ---
function mostrarProductos(categoria){
  categoriaActual = categoria;
  document.getElementById("categorias-section").style.display = "none";
  document.getElementById("productos-section").style.display = "block";
  document.getElementById("tituloProductos").innerText = categoria;
  cargarProductosGuardados();
}

function agregarProducto(){
  const lista = document.getElementById("productos-list");
  const div = document.createElement("div");
  div.classList.add("item");

  // Producto (subcategor√≠a principal del cat√°logo[categoriaActual])
  const selectProducto = document.createElement("select");
  selectProducto.innerHTML = "<option value=''>Seleccionar producto</option>";
  const opciones = catalogo[categoriaActual];
  for (let p in opciones){
    selectProducto.innerHTML += `<option value="${p}">${p}</option>`;
  }

  const selectSubtipo = document.createElement("select");
  selectSubtipo.style.display = "none";

  const selectMedida = document.createElement("select");
  selectMedida.style.display = "none";

  const inputCantidad = document.createElement("input");
  inputCantidad.type = "number";
  inputCantidad.min = "1";
  inputCantidad.placeholder = "Cantidad";
  inputCantidad.style.display = "none";

  selectProducto.addEventListener("change", ()=>{ manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });
  selectSubtipo.addEventListener("change", ()=>{ manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad); });

  div.appendChild(selectProducto);
  div.appendChild(selectSubtipo);
  div.appendChild(selectMedida);
  div.appendChild(inputCantidad);
  lista.appendChild(div);
}

function manejarProductoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad){
  const clave = selectProducto.value;
  const p = catalogo[categoriaActual][clave];

  selectSubtipo.style.display = "none";
  selectMedida.style.display = "none";
  inputCantidad.style.display = "none";
  selectSubtipo.innerHTML = "";
  selectMedida.innerHTML = "";

  if(!p) return;

  // Productos sin medida ‚Üí mostrar directamente opciones (cuando p es array y nombre del producto est√° en sinMedida)
  if (sinMedida.includes(clave) && Array.isArray(p)){
    selectSubtipo.style.display = "block";
    selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
    p.forEach(o => selectSubtipo.innerHTML += `<option value="${o}">${o}</option>`);
    inputCantidad.style.display = "block";
    return;
  }

  // Si p es array ‚Üí medidas directas
  if (Array.isArray(p)){
    selectMedida.style.display = "block";
    selectMedida.innerHTML = "<option value=''>Seleccionar</option>";
    p.forEach(m => selectMedida.innerHTML += `<option value="${m}">${m}</option>`);
    inputCantidad.style.display = "block";
  }
  // Si p es objeto ‚Üí mostrar subtipo (keys) para elegir y luego medidas
  else if (typeof p === "object"){
    selectSubtipo.style.display = "block";
    selectSubtipo.innerHTML = "<option value=''>Seleccionar</option>";
    for (let s in p){
      selectSubtipo.innerHTML += `<option value="${s}">${s}</option>`;
    }
  }
}

function manejarSubtipoChange(selectProducto, selectSubtipo, selectMedida, inputCantidad){
  const p = catalogo[categoriaActual][selectProducto.value];
  const medidas = p ? p[selectSubtipo.value] : null;
  selectMedida.innerHTML = "<option value=''>Seleccionar</option>";
  if (medidas && medidas.length > 0){
    selectMedida.style.display = "block";
    medidas.forEach(m => selectMedida.innerHTML += `<option value="${m}">${m}</option>`);
  } else {
    selectMedida.style.display = "none";
  }
  inputCantidad.style.display = "block";
}

function guardarProductos(){
  const lista = document.querySelectorAll("#productos-list .item");
  datosSeleccionados[categoriaActual] = [];
  lista.forEach(item=>{
    const producto = item.querySelector("select:nth-child(1)").value;
    const subtipo = item.querySelector("select:nth-child(2)") ? item.querySelector("select:nth-child(2)").value : "";
    const medida = item.querySelector("select:nth-child(3)") ? item.querySelector("select:nth-child(3)").value : "";
    const cantidadInput = item.querySelector("input");
    const cantidad = cantidadInput ? cantidadInput.value : "";
    if(producto && cantidad){
      datosSeleccionados[categoriaActual].push({producto,subtipo,medida,cantidad});
    }
  });
  // limpiar lista visual y volver a categorias
  document.getElementById("productos-list").innerHTML = "";
  document.getElementById("productos-section").style.display = "none";
  document.getElementById("categorias-section").style.display = "block";
}

function cargarProductosGuardados(){
  const lista = document.getElementById("productos-list");
  lista.innerHTML = "";
  datosSeleccionados[categoriaActual].forEach(item=>{
    const div = document.createElement("div");
    div.classList.add("item");
    // Mostrar la selecci√≥n ya guardada para edici√≥n simple (texto). Si quer√©s editar en detalle, puedo convertir esto en selects prefijados.
    div.innerHTML = `<div>${item.producto}${item.subtipo?` - ${item.subtipo}`:""}${item.medida?` : ${item.medida}`:""} x${item.cantidad}</div>`;
    lista.appendChild(div);
  });
}

// --- RESUMEN y env√≠o WhatsApp ---
let ultimoResumenTexto = "";

function mostrarResumen(){
  // Asegurarse de guardar los productos de la categor√≠a actual abierta primero
  guardarProductos();

  const resumenDiv = document.getElementById("resumenPedido");
  resumenDiv.innerHTML = "";

  // --- Construir el texto del pedido ---
  let textoResumen = "";
  const nombre = document.getElementById("nombre").value || "";
  const apellido = document.getElementById("apellido").value || "";
  const dni = document.getElementById("dni").value || "";
  const matricula = document.getElementById("matricula").value || "";
  const provincia = document.getElementById("provincia").value || "";
  const localidad = document.getElementById("localidad").value || "";

  textoResumen += `Nuevo Pedido Bio-Fix\n`;
  textoResumen += `Nombre: ${nombre} ${apellido}\nDNI: ${dni}\nMatr√≠cula: ${matricula}\nProvincia: ${provincia}, Localidad: ${localidad}\n--------------------\n`;

  // Productos: recorrer todas las categor√≠as en el orden original
  for (let cat of Object.keys(datosSeleccionados)){
    if (datosSeleccionados[cat] && datosSeleccionados[cat].length > 0){
      textoResumen += `${cat}:\n`;
      datosSeleccionados[cat].forEach(item=>{
        textoResumen += `* ${item.producto}${item.subtipo ? ' - '+item.subtipo : ''}${item.medida ? ' : '+item.medida : ''} x${item.cantidad}\n`;
      });
    }
  }

  // Mostrar resumen en pantalla
  resumenDiv.innerText = textoResumen;
  ultimoResumenTexto = textoResumen;

  // Crear botones de env√≠o para cada vendedor
  const contVendedores = document.getElementById("vendedoresBtns");
  contVendedores.innerHTML = "";
  vendedores.forEach(vendedor => {
    const btn = document.createElement("button");
    btn.textContent = `Enviar a ${vendedor.nombre}`;
    btn.onclick = () => {
      const link = `https://wa.me/${vendedor.numero}?text=${encodeURIComponent(ultimoResumenTexto)}`;
      window.open(link, "_blank");
    };
    contVendedores.appendChild(btn);
  });

  // Mostrar secci√≥n de resumen
  document.getElementById("productos-section").style.display="none";
  document.getElementById("categorias-section").style.display="none";
  document.getElementById("resumen-section").style.display="block";
}

// Funci√≥n auxiliar: enviar por defecto al primer vendedor (si quer√©s un bot√≥n general)
function enviarPedido(){
  if (!ultimoResumenTexto) mostrarResumen();
  const vendedor = vendedores[0];
  const link = `https://wa.me/${vendedor.numero}?text=${encodeURIComponent(ultimoResumenTexto)}`;
  window.open(link, "_blank");
}
</script>

</body>
</html>
